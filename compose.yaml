services:
  # 0twin2multicloud:
  #   image: 0twin2multicloud
  #   build: 
  #     context: ./twin2multicloud_cli
  #     dockerfile: /Dockerfile
  #   ports:
  #     - "5000:8000"
  #   volumes:
  #     - ./twin2multicloud_cli:/app
  #   tty: true
  #   networks:
  #     - my_master_thesis_network

  2twin2clouds:
    image: 2twin2clouds
    build: 
      context: .
      dockerfile: ./2-twin2clouds/Dockerfile
    ports:
      - "5003:8000"
    volumes:
      - ./2-twin2clouds:/app
      - ./config_credentials.json:/config/config_credentials.json
      - ./config.json:/config/config.json
      - ./google-credentials.json:/config/gcp_credentials.json
    tty: true
    networks:
      - my_master_thesis_network

  3cloud-deployer:
    image: 3cloud-deployer
    build: 
      context: .
      dockerfile: ./3-cloud-deployer/Dockerfile
    ports:
      - "5004:8000"
    volumes: 
      - ./3-cloud-deployer:/app/
      # mount into upload/template folder to simulate upload process
      - ./config.json:/config/config.json
      # - ./config_credentials.json:/config/config_credentials.json
      # - ./google-credentials.json:/config/gcp_credentials.json
    tty: true
    networks:
      - my_master_thesis_network

  # Management API (Sprint 1)
  management-api:
    build:
      context: ./twin2multicloud_backend
      dockerfile: Dockerfile
    ports:
      - "5005:5005"
    volumes:
      - ./twin2multicloud_backend:/app
      - management-data:/app/data
      - ./twin2multicloud_backend/data:/app/data
    environment:
      - DATABASE_URL=sqlite:///./data/app.db
      - JWT_SECRET_KEY=${JWT_SECRET_KEY:-dev-secret-key}
      - DEBUG=true
    networks:
      - my_master_thesis_network
    depends_on:
      - 2twin2clouds
      - 3cloud-deployer

### LaTeX Thesis ###
  # Watch mode (default): docker compose run --rm thesis-latex
  # Compile once:         docker compose run --rm thesis-latex latexmk -pdf -interaction=nonstopmode -cd /thesis/main.tex
  thesis-latex:
    image: thesis-latex
    build:
      context: ./twin2multicloud-latex
      dockerfile: Dockerfile
    volumes:
      - ./twin2multicloud-latex:/thesis
    profiles:
      - latex

networks:
  my_master_thesis_network:
    driver: bridge

volumes:
  management-data: