<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <title>Twin2Clouds Documentation — Design Patterns</title>
    <link rel="icon" type="image/x-icon" href="references/favicon.ico">
    <meta name="viewport" content="width=device-width,initial-scale=1" />

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

    <link rel="stylesheet" href="css/docs_styles.css" />

</head>

<body>

    <div class="layout">

        <aside id="nav-placeholder"></aside>

        <main class="p-4">

            <h1 class="mb-3">
                <i class="fa-solid fa-puzzle-piece me-2"></i>Design Patterns
            </h1>

            <p class="text-muted mb-4">
                This project uses formalized software design patterns to ensure maintainability,
                testability, and extensibility. This page documents which patterns are used,
                where they are implemented, and how to extend them.
            </p>

            <!-- Strategy Pattern -->
            <div class="card mb-4">
                <div class="card-header bg-primary text-white">
                    <h2 class="mb-0 h5"><i class="fa-solid fa-chess me-2"></i>Strategy Pattern</h2>
                </div>
                <div class="card-body">
                    <h5>What It Does</h5>
                    <p>
                        Defines a family of cloud provider cost calculators with interchangeable implementations.
                        Each provider (AWS, Azure, GCP) has its own calculator class that implements a common interface.
                    </p>

                    <h5>Where It's Used</h5>
                    <table class="table table-sm table-bordered">
                        <thead class="table-light">
                            <tr>
                                <th>File</th>
                                <th>Purpose</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><code>backend/calculation/base.py</code></td>
                                <td><strong>CloudProviderCalculator</strong> Protocol (interface) definition</td>
                            </tr>
                            <tr>
                                <td><code>backend/calculation/aws.py</code></td>
                                <td><strong>AWSCalculator</strong> class implementing the Protocol</td>
                            </tr>
                            <tr>
                                <td><code>backend/calculation/azure.py</code></td>
                                <td><strong>AzureCalculator</strong> class implementing the Protocol</td>
                            </tr>
                            <tr>
                                <td><code>backend/calculation/gcp.py</code></td>
                                <td><strong>GCPCalculator</strong> class implementing the Protocol</td>
                            </tr>
                        </tbody>
                    </table>

                    <h5>How to Extend</h5>
                    <p>To add a new cloud provider:</p>
                    <ol>
                        <li>Create a new calculator class (e.g., <code>OCICalculator</code>) in a new file</li>
                        <li>Implement all methods defined in <code>CloudProviderCalculator</code> Protocol</li>
                        <li>Register the calculator in <code>base.py</code>'s <code>get_calculators()</code> function
                        </li>
                    </ol>

                    <div class="alert alert-info">
                        <i class="fa-solid fa-info-circle me-1"></i>
                        <strong>Note:</strong> Each calculator accesses its own provider-specific pricing keys
                        (e.g., AWS uses <code>iotCore</code>, Azure uses <code>iotHub</code>).
                        The Protocol only unifies method signatures, not the underlying data structure.
                    </div>
                </div>
            </div>

            <!-- Builder Pattern -->
            <div class="card mb-4">
                <div class="card-header bg-success text-white">
                    <h2 class="mb-0 h5"><i class="fa-solid fa-hammer me-2"></i>Builder Pattern</h2>
                </div>
                <div class="card-body">
                    <h5>What It Does</h5>
                    <p>
                        Provides a fluent API for constructing cost calculation result objects.
                        Ensures all required fields are present and enables method chaining for readable code.
                    </p>

                    <h5>Where It's Used</h5>
                    <table class="table table-sm table-bordered">
                        <thead class="table-light">
                            <tr>
                                <th>File</th>
                                <th>Purpose</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><code>backend/calculation/builders.py</code></td>
                                <td><strong>LayerResultBuilder</strong> for layer cost results</td>
                            </tr>
                            <tr>
                                <td><code>backend/calculation/builders.py</code></td>
                                <td><strong>CostBreakdownBuilder</strong> for full optimization results</td>
                            </tr>
                        </tbody>
                    </table>

                    <h5>Example Usage</h5>
                    <pre class="bg-dark text-light p-3 rounded"><code>from backend.calculation.builders import LayerResultBuilder

result = (LayerResultBuilder("AWS")
    .set_cost(123.45)
    .set_data_size(10.5)
    .set_messages(1000000)
    .add_component("storageCost", 50.0)
    .add_component("computeCost", 73.45)
    .include_components()
    .build())</code></pre>
                </div>
            </div>

            <!-- Factory Pattern -->
            <div class="card mb-4">
                <div class="card-header bg-warning">
                    <h2 class="mb-0 h5"><i class="fa-solid fa-industry me-2"></i>Factory Pattern</h2>
                </div>
                <div class="card-body">
                    <h5>What It Does</h5>
                    <p>
                        Centralizes the creation of price fetcher instances.
                        Makes it easy to add new fetchers, mock fetchers for testing, or swap implementations.
                    </p>

                    <h5>Where It's Used</h5>
                    <table class="table table-sm table-bordered">
                        <thead class="table-light">
                            <tr>
                                <th>File</th>
                                <th>Purpose</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><code>backend/fetch_data/factory.py</code></td>
                                <td><strong>PriceFetcher</strong> Protocol and <strong>PriceFetcherFactory</strong>
                                    class</td>
                            </tr>
                            <tr>
                                <td><code>backend/fetch_data/factory.py</code></td>
                                <td><strong>AWSPriceFetcher</strong>, <strong>AzurePriceFetcher</strong>,
                                    <strong>GCPPriceFetcher</strong> wrapper classes
                                </td>
                            </tr>
                        </tbody>
                    </table>

                    <h5>Example Usage</h5>
                    <pre class="bg-dark text-light p-3 rounded"><code>from backend.fetch_data.factory import PriceFetcherFactory

# Create a specific fetcher
aws_fetcher = PriceFetcherFactory.create("aws")
prices = aws_fetcher.fetch_price("iotCore", "us-east-1", region_map)

# Get all available fetchers
for fetcher in PriceFetcherFactory.get_all():
    print(f"Fetcher: {fetcher.name}")</code></pre>

                    <h5>How to Register a Mock Fetcher</h5>
                    <pre class="bg-dark text-light p-3 rounded"><code># In tests, register a mock fetcher
class MockFetcher:
    name = "mock"
    def fetch_price(self, *args, **kwargs):
        return {"price": 0.0}

PriceFetcherFactory.register("mock", MockFetcher)</code></pre>
                </div>
            </div>

            <!-- Pattern Relationship Diagram -->
            <div class="card mb-4">
                <div class="card-header bg-secondary text-white">
                    <h2 class="mb-0 h5"><i class="fa-solid fa-diagram-project me-2"></i>Pattern Relationships</h2>
                </div>
                <div class="card-body text-center">
                    <p class="text-muted">How the patterns work together:</p>
                    <pre class="bg-dark p-3 rounded text-start" style="font-family: monospace;">
┌─────────────────────────────────────────────────────────────┐
│                    Calculation Engine                       │
│                      (engine.py)                            │
└─────────────────────────────────────────────────────────────┘
         │                    │                    │
         ▼                    ▼                    ▼
┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐
│  AWSCalculator  │  │ AzureCalculator │  │  GCPCalculator  │
│   (Strategy)    │  │   (Strategy)    │  │   (Strategy)    │
└─────────────────┘  └─────────────────┘  └─────────────────┘
         │                    │                    │
         └────────────────────┼────────────────────┘
                              ▼
                 ┌─────────────────────────┐
                 │   LayerResultBuilder    │
                 │       (Builder)         │
                 └─────────────────────────┘
                              ▼
                 ┌─────────────────────────┐
                 │   PriceFetcherFactory   │
                 │       (Factory)         │
                 └─────────────────────────┘
                              │
         ┌────────────────────┼────────────────────┐
         ▼                    ▼                    ▼
┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐
│ AWSPriceFetcher │  │AzurePriceFetcher│  │ GCPPriceFetcher │
└─────────────────┘  └─────────────────┘  └─────────────────┘
          </pre>
                </div>
            </div>

        </main>

    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <button id="backToTop" class="btn btn-primary rounded-circle position-fixed bottom-0 end-0 m-4 shadow fade p-3"
        style="display:none;">
        <i class="fa-solid fa-arrow-up"></i>
    </button>

    <script src="js/docs-nav.js" defer></script>
</body>

</html>