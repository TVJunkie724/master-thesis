<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <title>Twin2Clouds Documentation — Design Patterns</title>
    <link rel="icon" type="image/x-icon" href="references/favicon.ico">
    <meta name="viewport" content="width=device-width,initial-scale=1" />

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

    <link rel="stylesheet" href="css/docs_styles.css" />

</head>

<body>

    <div class="layout">

        <aside id="nav-placeholder"></aside>

        <main class="p-4">

            <h1 class="mb-3">
                <i class="fa-solid fa-puzzle-piece me-2"></i>Design Patterns
            </h1>

            <p class="text-muted mb-4">
                The Twin2Clouds cost optimizer uses formalized software design patterns to ensure maintainability,
                testability, and extensibility. This page provides an overview of the architecture and links to
                detailed documentation for each pattern.
            </p>

            <!-- Architecture Overview -->
            <div class="card mb-4">
                <div class="card-header bg-dark text-white">
                    <h2 class="mb-0 h5"><i class="fa-solid fa-sitemap me-2"></i>Architecture Overview</h2>
                </div>
                <div class="card-body">
                    <p>
                        The v2 cost calculation architecture follows a <strong>component-level approach</strong> where
                        costs are computed at the individual service level and aggregated upward to layers. This design
                        enables precise cost attribution and easy extension for new services.
                    </p>

                    <div class="row">
                        <div class="col-md-6">
                            <h5>Core Principles</h5>
                            <ul>
                                <li><strong>Separation of Concerns</strong> — Formulas, components, and layers are
                                    isolated</li>
                                <li><strong>Composability</strong> — Small, focused calculators combine into larger
                                    structures</li>
                                <li><strong>Type Safety</strong> — Protocols define clear interfaces between modules
                                </li>
                                <li><strong>Testability</strong> — Pure functions and dependency injection enable easy
                                    testing</li>
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <h5>Key Directories</h5>
                            <table class="table table-sm table-bordered">
                                <tbody>
                                    <tr>
                                        <td><code>calculation_v2/formulas/</code></td>
                                        <td>Pure cost formulas</td>
                                    </tr>
                                    <tr>
                                        <td><code>calculation_v2/components/</code></td>
                                        <td>Service-level calculators</td>
                                    </tr>
                                    <tr>
                                        <td><code>calculation_v2/layers/</code></td>
                                        <td>Layer-level aggregators</td>
                                    </tr>
                                    <tr>
                                        <td><code>fetch_data/</code></td>
                                        <td>Pricing data fetchers</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Architecture Diagram -->
                    <h5 class="mt-3">Data Flow</h5>
                    <pre class="bg-dark p-3 rounded text-start text-light"
                        style="font-family: monospace; font-size: 0.85rem;">
┌─────────────────────────────────────────────────────────────────────────────┐
│                              API Layer                                       │
│                         (api/calculation.py)                                 │
└─────────────────────────────────────────────────────────────────────────────┘
                                     │
                                     ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                          Calculation Engine                                  │
│                    (calculation_v2/engine.py)                                │
│         Orchestrates provider calculations, finds cheapest path              │
└─────────────────────────────────────────────────────────────────────────────┘
                                     │
          ┌──────────────────────────┼──────────────────────────┐
          ▼                          ▼                          ▼
┌───────────────────┐    ┌───────────────────┐    ┌───────────────────┐
│ AWSLayerCalculators│    │AzureLayerCalculators│   │ GCPLayerCalculators│
│     (Facade)       │    │      (Facade)       │   │      (Facade)      │
└───────────────────┘    └───────────────────┘    └───────────────────┘
          │                          │                          │
          ▼                          ▼                          ▼
┌───────────────────┐    ┌───────────────────┐    ┌───────────────────┐
│ Component Calculators│  │ Component Calculators│  │ Component Calculators│
│  (IoT, Lambda, etc.) │  │  (IoT Hub, Functions) │  │  (PubSub, Functions) │
│     (Protocol)       │  │      (Protocol)       │  │      (Protocol)      │
└───────────────────┘    └───────────────────┘    └───────────────────┘
          │                          │                          │
          └──────────────────────────┼──────────────────────────┘
                                     ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                           Core Formulas                                      │
│                    (calculation_v2/formulas/)                                │
│              Pure mathematical functions: CM, CE, CA, CS, CU, CT             │
└─────────────────────────────────────────────────────────────────────────────┘
                                     ▲
                                     │
┌─────────────────────────────────────────────────────────────────────────────┐
│                        PriceFetcherFactory                                   │
│                       (fetch_data/factory.py)                                │
│              Creates provider-specific pricing data fetchers                 │
└─────────────────────────────────────────────────────────────────────────────┘</pre>
                </div>
            </div>

            <!-- Backend Patterns -->
            <div class="card mb-4">
                <div class="card-header bg-primary text-white">
                    <h2 class="mb-0 h5"><i class="fa-solid fa-server me-2"></i>Backend Patterns</h2>
                </div>
                <div class="card-body">
                    <p>
                        The Python backend uses six core design patterns to structure the cost calculation system.
                        Click each pattern for detailed documentation including code examples and extension guides.
                    </p>

                    <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-3">
                        <!-- Pure Functions -->
                        <div class="col">
                            <a href="docs-pattern-pure-functions.html" class="text-decoration-none">
                                <div class="card h-100 border-success">
                                    <div class="card-body">
                                        <h5 class="card-title text-success">
                                            <i class="fa-solid fa-function me-2"></i>Pure Functions
                                        </h5>
                                        <p class="card-text text-muted small">
                                            Mathematical formulas with no side effects. The foundation of all cost
                                            calculations.
                                        </p>
                                        <span class="badge bg-success">Core Formula</span>
                                    </div>
                                </div>
                            </a>
                        </div>

                        <!-- Protocol Pattern -->
                        <div class="col">
                            <a href="docs-pattern-protocol.html" class="text-decoration-none">
                                <div class="card h-100 border-info">
                                    <div class="card-body">
                                        <h5 class="card-title text-info">
                                            <i class="fa-solid fa-handshake me-2"></i>Protocol Pattern
                                        </h5>
                                        <p class="card-text text-muted small">
                                            Type-safe interfaces using Python's <code>typing.Protocol</code> for
                                            structural subtyping.
                                        </p>
                                        <span class="badge bg-info">Interface</span>
                                    </div>
                                </div>
                            </a>
                        </div>

                        <!-- Component Calculator -->
                        <div class="col">
                            <a href="docs-pattern-component.html" class="text-decoration-none">
                                <div class="card h-100 border-primary">
                                    <div class="card-body">
                                        <h5 class="card-title text-primary">
                                            <i class="fa-solid fa-microchip me-2"></i>Component Calculator
                                        </h5>
                                        <p class="card-text text-muted small">
                                            Service-specific cost calculators that implement the
                                            <code>ResourceCalculator</code> protocol.
                                        </p>
                                        <span class="badge bg-primary">Service-Level</span>
                                    </div>
                                </div>
                            </a>
                        </div>

                        <!-- Facade Pattern -->
                        <div class="col">
                            <a href="docs-pattern-facade.html" class="text-decoration-none">
                                <div class="card h-100 border-warning">
                                    <div class="card-body">
                                        <h5 class="card-title text-warning">
                                            <i class="fa-solid fa-layer-group me-2"></i>Facade Pattern
                                        </h5>
                                        <p class="card-text text-muted small">
                                            Layer-level aggregators that combine component costs into unified results.
                                        </p>
                                        <span class="badge bg-warning">Layer-Level</span>
                                    </div>
                                </div>
                            </a>
                        </div>

                        <!-- Dataclass Pattern -->
                        <div class="col">
                            <a href="docs-pattern-dataclass.html" class="text-decoration-none">
                                <div class="card h-100 border-secondary">
                                    <div class="card-body">
                                        <h5 class="card-title text-secondary">
                                            <i class="fa-solid fa-database me-2"></i>Dataclass Pattern
                                        </h5>
                                        <p class="card-text text-muted small">
                                            Immutable result containers using Python's <code>@dataclass</code>
                                            decorator.
                                        </p>
                                        <span class="badge bg-secondary">Data Structure</span>
                                    </div>
                                </div>
                            </a>
                        </div>

                        <!-- Factory Pattern -->
                        <div class="col">
                            <a href="docs-pattern-factory.html" class="text-decoration-none">
                                <div class="card h-100 border-danger">
                                    <div class="card-body">
                                        <h5 class="card-title text-danger">
                                            <i class="fa-solid fa-industry me-2"></i>Factory Pattern
                                        </h5>
                                        <p class="card-text text-muted small">
                                            Centralized creation of pricing fetcher instances with registry support.
                                        </p>
                                        <span class="badge bg-danger">Creation</span>
                                    </div>
                                </div>
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Frontend Patterns -->
            <div class="card mb-4">
                <div class="card-header bg-success text-white">
                    <h2 class="mb-0 h5"><i class="fa-brands fa-js me-2"></i>Frontend Patterns</h2>
                </div>
                <div class="card-body">
                    <p>
                        The JavaScript frontend uses modular patterns to manage configuration, UI rendering, and API
                        communication.
                    </p>

                    <a href="docs-pattern-frontend.html" class="btn btn-outline-success btn-lg w-100">
                        <i class="fa-solid fa-arrow-right me-2"></i>View Frontend Architecture &amp; Patterns
                    </a>

                    <div class="row mt-3">
                        <div class="col-md-6">
                            <h6>Key Patterns</h6>
                            <ul class="list-unstyled">
                                <li><i class="fa-solid fa-check text-success me-2"></i><strong>Registry Pattern</strong>
                                    — Configuration objects for layers, providers, services</li>
                                <li><i class="fa-solid fa-check text-success me-2"></i><strong>Component
                                        Pattern</strong>
                                    — Reusable UI elements (cards, tables, warnings)</li>
                                <li><i class="fa-solid fa-check text-success me-2"></i><strong>Orchestrator
                                        Pattern</strong> — Coordinates UI updates from API responses</li>
                                <li><i class="fa-solid fa-check text-success me-2"></i><strong>Utility Pattern</strong>
                                    — Helper functions for formatting and parsing</li>
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <h6>Module Structure</h6>
                            <table class="table table-sm table-bordered">
                                <tbody>
                                    <tr>
                                        <td><code>js/config/</code></td>
                                        <td>Registries (layers, providers, services)</td>
                                    </tr>
                                    <tr>
                                        <td><code>js/components/</code></td>
                                        <td>Reusable UI components</td>
                                    </tr>
                                    <tr>
                                        <td><code>js/utils/</code></td>
                                        <td>Formatting and parsing helpers</td>
                                    </tr>
                                    <tr>
                                        <td><code>js/api.js</code></td>
                                        <td>Backend API communication</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Deprecated Patterns Notice -->
            <div class="alert alert-warning" role="alert">
                <h5 class="alert-heading"><i class="fa-solid fa-triangle-exclamation me-2"></i>Deprecated Patterns</h5>
                <p class="mb-0">
                    The <strong>Strategy Pattern</strong> and <strong>Builder Pattern</strong> documented in earlier
                    versions have been deprecated. The code remains in <code>backend/deprecated_calculation/</code> for
                    reference but is no longer used. The v2 architecture described above replaces these patterns with a
                    more modular component-based approach.
                </p>
            </div>

        </main>

    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <button id="backToTop" class="btn btn-primary rounded-circle position-fixed bottom-0 end-0 m-4 shadow fade p-3"
        style="display:none;">
        <i class="fa-solid fa-arrow-up"></i>
    </button>

    <script src="js/docs-nav.js" defer></script>
</body>

</html>