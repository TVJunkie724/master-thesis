<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <title>AWS Pricing Schema — Twin2Clouds Documentation</title>
  <link rel="icon" type="image/x-icon" href="../references/favicon.ico">
  <meta name="viewport" content="width=device-width,initial-scale=1" />

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <link rel="stylesheet" href="../css/docs_styles.css" />
</head>

<body>

  <div class="layout">
    <aside id="nav-placeholder"></aside>

    <main class="p-4">
      <h1 class="mb-3">
        <i class="fa-brands fa-aws me-2 text-warning"></i> AWS Pricing Schema
      </h1>

      <p class="text-muted mb-4">
        Field sources, fetched dimensions, static defaults, and calculated logic for
        <span class="mono">pricing.json</span> (AWS section).
      </p>

      <!-- Schema Overview -->
      <div class="card mb-4" id="schema">
        <div class="card-body">
          <h2 class="mb-3"><i class="fa-solid fa-file-code me-2"></i>Schema Overview</h2>
          <p>Target structure (AWS excerpt from <span class="mono">pricing.json</span>):</p>
          <pre class="p-3 rounded border"><code>{
  "aws": {
    "transfer": { "pricing_tiers": 
        "freeTier": {"limit": ..., "price": ...},
        "tier1": {"limit": ..., "price": ...},
        "tier2": {"limit": ..., "price": ...},
        "tier3": {"limit": ..., "price": ...},
        "tier4": {"limit": ..., "price": ...} },
    "egressPrice": 0.09,
    "iotCore": {
      "pricePerDeviceAndMonth": 0.0035,
      "priceRulesTriggered": 0.00000015,
      "pricing_tiers": { "tier1": {...}, "tier2": {...}, "tier3": {...} }
    },
    "lambda": {
      "requestPrice": 0.0000002,
      "durationPrice": 0.0000166667,
      "freeRequests": 1000000,
      "freeComputeTime": 400000
    },
    "dynamoDB": { 
      "writePrice": ..., 
      "readPrice": ..., 
      "storagePrice": ..., 
      "freeStorage": 25 
    },
    "s3InfrequentAccess": {
      "storagePrice": ...,
      "upfrontPrice": ...,
      "requestPrice": ...,
      "dataRetrievalPrice": ...,
      "transferCostFromDynamoDB": ...,
      "transferCostFromCosmosDB": ...
    },
    "s3GlacierDeepArchive": {
      "storagePrice": ..., 
      "lifecycleAndWritePrice": ..., 
      "dataRetrievalPrice": ...
    },
    "apiGateway": {
      "pricePerMillionCalls": ...,
      "dataTransferOutPrice": ...
    },
    "stepFunctions": {
      "pricePer1kStateTransitions": ...
    },
    "eventBridge": {
      "pricePerMillionEvents": ...
    },
    "iotTwinMaker": {
      "unifiedDataAccessAPICallsPrice": ...,
      "entityPrice": ...,
      "queryPrice": ...
    },
    "awsManagedGrafana": {
      "editorPrice": ...,
      "viewerPrice": ...
    },
    "scheduler": {
      "jobPrice": ...
    }
  }
}</code></pre>
        </div>
      </div>
      <div class="card mb-4" id="fetching">
        <div class="card-body">
          <h2 class="mb-3"><i class="fa-solid fa-download me-2"></i>How Fetching Works</h2>
          <p>We query the <strong>AWS Pricing API</strong> (<span class="mono">get_products</span>) per service code and
            region.</p>
          <ul>
            <li><strong>Filtering:</strong> We filter by <span class="mono">location</span> and use curated
              <strong>include/exclude keyword</strong> lists to match the specific <span
                class="mono">priceDimensions[].description</span> we need.
            </li>
            <li><strong>Cleaning:</strong> We discard dimensions related to cross-AZ, global tables, or replication to
              isolate the base per-unit metrics.</li>
          </ul>
        </div>
      </div>

      <!-- Services -->
      <div class="card mb-4" id="services">
        <div class="card-body">
          <h2 class="mb-3"><i class="fa-solid fa-cubes me-2"></i>Services & Fields</h2>

          <!-- Transfer -->
          <h3 class="mt-4 mb-2 text-primary">Data Transfer (Egress)</h3>
          <p><strong>Service:</strong> AmazonEC2</p>
          <table class="table table-hover table-bordered">
            <thead>
              <tr>
                <th>Field</th>
                <th>Source</th>
                <th>Notes</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="mono">transfer.pricing_tiers</td>
                <td><span class="badge text-bg-success">Fetched</span></td>
                <td>Built from <em>per GB</em> “DataTransfer-Out-Bytes”. Uses beginRange/endRange.</td>
              </tr>
              <tr>
                <td class="mono">egressPrice</td>
                <td><span class="badge text-bg-success">Fetched</span></td>
                <td>Lowest tier unit price (e.g., 0.09 $/GB).</td>
              </tr>
            </tbody>
          </table>

          <!-- IoT Core -->
          <h3 class="mt-4 mb-2 text-primary">IoT Core (Layer 1)</h3>
          <p><strong>Service:</strong> AWS IoTCore</p>
          <table class="table table-hover table-bordered">
            <thead>
              <tr>
                <th>Field</th>
                <th>Source</th>
                <th>Notes</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="mono">iotCore.pricePerDeviceAndMonth</td>
                <td><span class="badge text-bg-warning">Static</span></td>
                <td>0.0035 $/device/month (not exposed in API).</td>
              </tr>
              <tr>
                <td class="mono">iotCore.priceRulesTriggered</td>
                <td><span class="badge text-bg-success">Fetched</span></td>
                <td>Matched “per million rules triggered”.</td>
              </tr>
              <tr>
                <td class="mono">iotCore.pricing_tiers</td>
                <td><span class="badge text-bg-success">Fetched</span></td>
                <td>Message tiers (“first 1B”, “next 4B”, etc.).</td>
              </tr>
            </tbody>
          </table>

          <!-- Lambda -->
          <h3 class="mt-4 mb-2 text-primary">Lambda (Layer 2)</h3>
          <p><strong>Service:</strong> AWS Lambda</p>
          <table class="table table-hover table-bordered">
            <thead>
              <tr>
                <th>Field</th>
                <th>Source</th>
                <th>Notes</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="mono">requestPrice</td>
                <td><span class="badge text-bg-success">Fetched</span></td>
                <td>Matched “total requests”.</td>
              </tr>
              <tr>
                <td class="mono">durationPrice</td>
                <td><span class="badge text-bg-success">Fetched</span></td>
                <td>Tier-1 price per GB-second.</td>
              </tr>
              <tr>
                <td class="mono">freeRequests</td>
                <td><span class="badge text-bg-warning">Static</span></td>
                <td>1,000,000 requests/month free tier.</td>
              </tr>
              <tr>
                <td class="mono">freeComputeTime</td>
                <td><span class="badge text-bg-warning">Static</span></td>
                <td>400,000 GB-s/month free tier.</td>
              </tr>
            </tbody>
          </table>

          <!-- DynamoDB -->
          <h3 class="mt-4 mb-2 text-primary">DynamoDB (Layer 3 - Hot)</h3>
          <p><strong>Service:</strong> Amazon DynamoDB</p>
          <table class="table table-hover table-bordered">
            <thead>
              <tr>
                <th>Field</th>
                <th>Source</th>
                <th>Notes</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="mono">writePrice</td>
                <td><span class="badge text-bg-success">Fetched</span></td>
                <td>Per million write request units.</td>
              </tr>
              <tr>
                <td class="mono">readPrice</td>
                <td><span class="badge text-bg-success">Fetched</span></td>
                <td>Per million read request units.</td>
              </tr>
              <tr>
                <td class="mono">storagePrice</td>
                <td><span class="badge text-bg-success">Fetched</span></td>
                <td>Per GB-month storage.</td>
              </tr>
              <tr>
                <td class="mono">freeStorage</td>
                <td><span class="badge text-bg-warning">Static</span></td>
                <td>25 GB free tier.</td>
              </tr>
            </tbody>
          </table>

          <!-- S3 IA -->
          <h3 class="mt-4 mb-2 text-primary">S3 Infrequent Access (Layer 3 - Cool)</h3>
          <p><strong>Service:</strong> Amazon S3</p>
          <table class="table table-hover table-bordered">
            <thead>
              <tr>
                <th>Field</th>
                <th>Source</th>
                <th>Notes</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="mono">storagePrice</td>
                <td><span class="badge text-bg-success">Fetched</span></td>
                <td>Per GB-month (Standard-IA).</td>
              </tr>
              <tr>
                <td class="mono">requestPrice</td>
                <td><span class="badge text-bg-success">Fetched</span></td>
                <td>Per 10,000 GET requests.</td>
              </tr>
              <tr>
                <td class="mono">dataRetrievalPrice</td>
                <td><span class="badge text-bg-success">Fetched</span></td>
                <td>Per GB retrieved.</td>
              </tr>
              <tr>
                <td class="mono">upfrontPrice</td>
                <td><span class="badge text-bg-warning">Static</span></td>
                <td>Overhead constant (0.0001).</td>
              </tr>
            </tbody>
          </table>

          <!-- S3 Glacier -->
          <h3 class="mt-4 mb-2 text-primary">S3 Glacier Deep Archive (Layer 3 - Archive)</h3>
          <p><strong>Service:</strong> Amazon S3</p>
          <table class="table table-hover table-bordered">
            <thead>
              <tr>
                <th>Field</th>
                <th>Source</th>
                <th>Notes</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="mono">storagePrice</td>
                <td><span class="badge text-bg-success">Fetched</span></td>
                <td>Per GB-month (Glacier Deep Archive).</td>
              </tr>
              <tr>
                <td class="mono">lifecycleAndWritePrice</td>
                <td><span class="badge text-bg-success">Fetched</span></td>
                <td>Per 1,000 Lifecycle requests.</td>
              </tr>
              <tr>
                <td class="mono">dataRetrievalPrice</td>
                <td><span class="badge text-bg-success">Fetched</span></td>
                <td>Per GB Standard retrieval.</td>
              </tr>
            </tbody>
          </table>

          <!-- API Gateway -->
          <h3 class="mt-4 mb-2 text-primary">Data Access (Supporting)</h3>
          <p><strong>Service:</strong> Amazon API Gateway</p>
          <table class="table table-hover table-bordered">
            <thead>
              <tr>
                <th>Field</th>
                <th>Source</th>
                <th>Notes</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="mono">pricePerMillionCalls</td>
                <td><span class="badge text-bg-success">Fetched</span></td>
                <td>Price per million API calls (REST/HTTP).</td>
              </tr>
              <tr>
                <td class="mono">dataTransferOutPrice</td>
                <td><span class="badge text-bg-success">Fetched</span></td>
                <td>Data transfer out price per GB (Internet).</td>
              </tr>
            </tbody>
          </table>

          <!-- Step Functions -->
          <h3 class="mt-4 mb-2 text-primary">Orchestration (Supporting)</h3>
          <p><strong>Service:</strong> AWS Step Functions</p>
          <table class="table table-hover table-bordered">
            <thead>
              <tr>
                <th>Field</th>
                <th>Source</th>
                <th>Notes</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="mono">pricePer1kStateTransitions</td>
                <td><span class="badge text-bg-success">Fetched</span></td>
                <td>Standard Workflow state transition price.</td>
              </tr>
            </tbody>
          </table>

          <!-- EventBridge -->
          <h3 class="mt-4 mb-2 text-primary">Event Bus (Supporting)</h3>
          <p><strong>Service:</strong> Amazon EventBridge</p>
          <table class="table table-hover table-bordered">
            <thead>
              <tr>
                <th>Field</th>
                <th>Source</th>
                <th>Notes</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="mono">pricePerMillionEvents</td>
                <td><span class="badge text-bg-success">Fetched</span></td>
                <td>Custom events put to event bus.</td>
              </tr>
            </tbody>
          </table>

          <!-- TwinMaker -->
          <h3 class="mt-4 mb-2 text-primary">IoT TwinMaker (Layer 4)</h3>
          <p><strong>Service:</strong> AWS IoT TwinMaker</p>
          <table class="table table-hover table-bordered">
            <thead>
              <tr>
                <th>Field</th>
                <th>Source</th>
                <th>Notes</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="mono">entityPrice</td>
                <td><span class="badge text-bg-success">Fetched</span></td>
                <td>Per entity per month.</td>
              </tr>
              <tr>
                <td class="mono">unifiedDataAccessAPICallsPrice</td>
                <td><span class="badge text-bg-success">Fetched</span></td>
                <td>Per million API calls.</td>
              </tr>
              <tr>
                <td class="mono">queryPrice</td>
                <td><span class="badge text-bg-success">Fetched</span></td>
                <td>Per 10,000 queries.</td>
              </tr>
            </tbody>
          </table>

          <!-- Grafana -->
          <h3 class="mt-4 mb-2 text-primary">Managed Grafana (Layer 5)</h3>
          <p><strong>Service:</strong> Amazon Managed Grafana</p>
          <table class="table table-hover table-bordered">
            <thead>
              <tr>
                <th>Field</th>
                <th>Source</th>
                <th>Notes</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="mono">editorPrice</td>
                <td><span class="badge text-bg-warning">Static</span></td>
                <td>$9.00 / editor / month.</td>
              </tr>
              <tr>
                <td class="mono">viewerPrice</td>
                <td><span class="badge text-bg-warning">Static</span></td>
                <td>$5.00 / viewer / month.</td>
              </tr>
            </tbody>
          </table>

          <!-- Scheduler -->
          <h3 class="mt-4 mb-2 text-primary">Scheduler (Orchestration)</h3>
          <p><strong>Service:</strong> Amazon EventBridge Scheduler</p>
          <table class="table table-hover table-bordered">
            <thead>
              <tr>
                <th>Field</th>
                <th>Source</th>
                <th>Notes</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="mono">jobPrice</td>
                <td><span class="badge text-bg-success">Fetched</span></td>
                <td>Per job per month.</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- Calculated Fields -->
      <div class="card mb-4" id="calculated">
        <div class="card-body">
          <h2 class="mb-3"><i class="fa-solid fa-calculator me-2"></i>Calculated Fields</h2>
          <p>These values are derived in <span class="mono">apply_aws_derived_fields()</span> after fetching.</p>
          <table class="table table-hover table-bordered">
            <thead>
              <tr>
                <th>Field</th>
                <th>Formula</th>
                <th>Purpose</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="mono">s3InfrequentAccess.transferCostFromDynamoDB</td>
                <td><code>egressPrice × 1.1</code></td>
                <td>Est. transfer DynamoDB → S3 (10% overhead).</td>
              </tr>
              <tr>
                <td class="mono">s3InfrequentAccess.transferCostFromCosmosDB</td>
                <td><code>egressPrice × 0.55</code></td>
                <td>Est. transfer Azure → AWS (approx. half egress).</td>
              </tr>
              <tr>
                <td class="mono">iotCore.avgMessagePriceFor10M</td>
                <td><code>mean(pricing_tiers)</code></td>
                <td>Helper metric for quick estimations.</td>
              </tr>
              <tr>
                <td class="mono">lambda.costPerExecutionExample</td>
                <td><code>request + (duration × 0.128)</code></td>
                <td>Avg cost per execution (128MB).</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>


      <!-- High Volume Cost Warning -->
      <div class="card mb-4 border-warning">
        <div class="card-header bg-warning-subtle text-warning-emphasis">
          <h2 class="h5 mb-0"><i class="fa-solid fa-triangle-exclamation me-2"></i>High Usage & Cost Anomalies</h2>
        </div>
        <div class="card-body">
          <p>
            Startups and small projects often use <strong>Standard Plan</strong> serverless services (e.g., Step
            Functions Standard)
            successfully. However, at massive scale (e.g., <strong>billions</strong> of messages per month), these
            standard
            tiers can become prohibitively expensive.
          </p>

          <p class="mb-0">
            <strong>Example:</strong> For 30,000 devices sending every 6 seconds (~13 billion messages/month),
            using <strong>Step Functions Standard</strong> workflows would theoretically cost <strong>millions of
              dollars</strong>.
            <br>
            <em>Twin2Clouds calculates the "list price" cost. In a real-world high-volume scenario, you would switch to
              <strong>Express Workflows</strong> or negotiate an Enterprise Agreement, which is not reflected here.</em>
          </p>
        </div>
      </div>

    </main>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <button id="backToTop" class="btn btn-primary rounded-circle position-fixed bottom-0 end-0 m-4 shadow fade p-3"
    style="display:none;">
    <i class="fa-solid fa-arrow-up"></i>
  </button>
  <script src="../js/docs-nav.js" defer></script>
</body>

</html>