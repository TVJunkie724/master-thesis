<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <title>AWS Credentials Setup — Twin2Clouds Documentation</title>
    <link rel="icon" type="image/x-icon" href="references/favicon.ico">
    <meta name="viewport" content="width=device-width,initial-scale=1" />

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link rel="stylesheet" href="css/docs_styles.css" />
</head>

<body>

    <div class="layout">
        <aside id="nav-placeholder"></aside>

        <main class="p-4">
            <h1 class="mb-3">
                <i class="fa-brands fa-aws me-2"></i> AWS Credentials Setup
            </h1>

            <p class="text-muted mb-4">
                Configure AWS IAM credentials for fetching pricing data from the AWS Price List API.
            </p>

            <!-- Breadcrumb -->
            <nav aria-label="breadcrumb" class="mb-4">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="docs-credentials-setup.html">Credentials Setup</a></li>
                    <li class="breadcrumb-item active" aria-current="page">AWS</li>
                </ol>
            </nav>

            <div class="card mb-4" id="requirements">
                <div class="card-body">
                    <h2 class="mb-3"><i class="fa-solid fa-list-check me-2"></i>Requirements</h2>

                    <p>The Twin2Clouds Optimizer only needs <strong>read-only access</strong> to the AWS Pricing API.
                        This requires just three IAM permissions:</p>

                    <table class="table table-sm">
                        <thead>
                            <tr>
                                <th>Permission</th>
                                <th>Purpose</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><code>pricing:DescribeServices</code></td>
                                <td>List available AWS services and their pricing attributes</td>
                            </tr>
                            <tr>
                                <td><code>pricing:GetProducts</code></td>
                                <td>Retrieve pricing details for specific services (EC2, Lambda, etc.)</td>
                            </tr>
                            <tr>
                                <td><code>pricing:GetAttributeValues</code></td>
                                <td>Get valid values for pricing attributes (regions, instance types)</td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="callout info">
                        <strong><i class="fa-solid fa-circle-info me-2"></i>Note</strong>
                        The AWS Price List API is only available in the <code>us-east-1</code> region. The Optimizer
                        automatically uses this region for pricing requests, regardless of your configured region.
                    </div>
                </div>
            </div>

            <!-- Table of Contents -->
            <div class="card mb-4">
                <div class="card-body">
                    <h2 class="mb-3"><i class="fa-solid fa-list me-2"></i>Contents</h2>
                    <ul>
                        <li><a href="#step1">Step 1: Create an IAM User</a></li>
                        <li><a href="#step2">Step 2: Create IAM Policy</a></li>
                        <li><a href="#step3">Step 3: Generate Access Keys</a></li>
                        <li><a href="#step4">Step 4: Configure Credentials</a></li>
                        <li><a href="#step5">Step 5: Verify Setup</a></li>
                    </ul>
                </div>
            </div>

            <div class="card mb-4" id="step1">
                <div class="card-body">
                    <h2 class="mb-3">Step 1: Create an IAM User</h2>

                    <ol>
                        <li>Sign in to the <a href="https://console.aws.amazon.com/iam/" target="_blank">AWS IAM
                                Console</a>
                        </li>
                        <li>Navigate to <strong>Users</strong> → <strong>Create user</strong></li>
                        <li>Enter a username (e.g., <code>twin2clouds-pricing</code>)</li>
                        <li>Click <strong>Next</strong> (skip console access - not needed)</li>
                        <li>Select <strong>Attach policies directly</strong></li>
                        <li>You'll attach the custom policy in the next step</li>
                    </ol>

                    <div class="callout info mt-3">
                        <strong><i class="fa-solid fa-shield-halved me-2"></i>AWS Best Practice</strong>
                        Create a dedicated IAM user specifically for the Optimizer. This follows the principle of
                        least privilege and makes it easy to audit or revoke access.
                    </div>
                </div>
            </div>

            <div class="card mb-4" id="step2">
                <div class="card-body">
                    <h2 class="mb-3">Step 2: Create IAM Policy</h2>

                    <p>Create a custom policy with minimal required permissions:</p>

                    <h5 class="mt-3"><i class="fa-solid fa-display me-2"></i>Option A: AWS Console (GUI)</h5>
                    <ol>
                        <li>Navigate to <strong>Policies</strong> → <strong>Create policy</strong></li>
                        <li>Select the <strong>JSON</strong> tab</li>
                        <li>Copy the policy document from: <a href="references/aws_pricing_policy.json" target="_blank"
                                class="btn btn-sm btn-outline-primary">
                                <i class="fa-solid fa-download me-1"></i>aws_pricing_policy.json
                            </a></li>
                        <li>Paste into the JSON editor and click <strong>Next</strong></li>
                        <li>Name the policy (e.g., <code>Twin2CloudsPricingReadOnly</code>)</li>
                        <li>Click <strong>Create policy</strong></li>
                        <li>Go back to your IAM user and attach this policy</li>
                    </ol>

                    <h5 class="mt-4"><i class="fa-solid fa-terminal me-2"></i>Option B: AWS CLI (One Command)</h5>
                    <p>If you have the AWS CLI configured:</p>
                    <pre class="p-3 rounded"><code># Create the policy
aws iam create-policy \
    --policy-name Twin2CloudsPricingReadOnly \
    --policy-document '{
        "Version": "2012-10-17",
        "Statement": [{
            "Effect": "Allow",
            "Action": [
                "pricing:DescribeServices",
                "pricing:GetProducts",
                "pricing:GetAttributeValues"
            ],
            "Resource": "*"
        }]
    }'

# Attach to your user (replace YOUR_ACCOUNT_ID)
aws iam attach-user-policy \
    --user-name twin2clouds-pricing \
    --policy-arn arn:aws:iam::YOUR_ACCOUNT_ID:policy/Twin2CloudsPricingReadOnly</code></pre>
                </div>
            </div>

            <div class="card mb-4" id="step3">
                <div class="card-body">
                    <h2 class="mb-3">Step 3: Generate Access Keys</h2>

                    <ol>
                        <li>Select your IAM user → <strong>Security credentials</strong> tab</li>
                        <li>Under <strong>Access keys</strong>, click <strong>Create access key</strong></li>
                        <li>Select <strong>Application running outside AWS</strong></li>
                        <li>Click <strong>Create access key</strong></li>
                        <li>
                            <strong>Important:</strong> Download the <code>.csv</code> file or copy both keys
                            immediately.
                            The secret key is only shown once!
                        </li>
                    </ol>

                    <div class="callout warn mt-3">
                        <strong><i class="fa-solid fa-exclamation-triangle me-2"></i>Save Your Keys!</strong>
                        The <strong>Secret Access Key</strong> is only displayed once. If you lose it, you'll need to
                        create new access keys.
                    </div>
                </div>
            </div>

            <div class="card mb-4" id="step4">
                <div class="card-body">
                    <h2 class="mb-3">Step 4: Configure Credentials</h2>

                    <p>Add your credentials to <code>config/config_credentials.json</code>:</p>
                    <pre class="p-3 rounded"><code>{
  "aws": {
    "aws_access_key_id": "AKIAIOSFODNN7EXAMPLE",
    "aws_secret_access_key": "wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY",
    "aws_region": "eu-central-1"
  }
}</code></pre>

                    <div class="callout info mt-3">
                        <strong><i class="fa-solid fa-globe me-2"></i>Region Note</strong>
                        The <code>aws_region</code> field is used for other AWS operations, but pricing API calls
                        automatically use <code>us-east-1</code> regardless of this setting.
                    </div>

                    <div class="callout warn mt-3">
                        <strong><i class="fa-solid fa-exclamation-triangle me-2"></i>Security Warning</strong>
                        Never commit <code>config_credentials.json</code> to version control! This file is in
                        <code>.gitignore</code>.
                    </div>
                </div>

                <div class="card mb-4" id="step5">
                    <div class="card-body">
                        <h2 class="mb-3">Step 5: Verify Setup</h2>

                        <p>Use the built-in credential checker to verify your setup:</p>
                        <pre class="p-3 rounded"><code># REST API
GET /permissions/verify/aws

# Or using cURL
curl http://localhost:5003/permissions/verify/aws</code></pre>

                        <h5 class="mt-4">Expected Response (Success)</h5>
                        <pre class="p-3 rounded"><code>{
  "provider": "aws",
  "status": "valid",
  "message": "AWS credentials are valid and can access Pricing API",
  "config_present": true,
  "credentials_valid": true,
  "can_fetch_pricing": true,
  "identity": {
    "account": "123456789012",
    "arn": "arn:aws:iam::123456789012:user/twin2clouds-pricing"
  }
}</code></pre>

                        <h5 class="mt-4">Common Issues</h5>
                        <table class="table table-sm">
                            <thead>
                                <tr>
                                    <th>Error</th>
                                    <th>Solution</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><code>InvalidClientTokenId</code></td>
                                    <td>Access key ID is incorrect or inactive</td>
                                </tr>
                                <tr>
                                    <td><code>SignatureDoesNotMatch</code></td>
                                    <td>Secret access key is incorrect</td>
                                </tr>
                                <tr>
                                    <td><code>AccessDeniedException</code></td>
                                    <td>IAM policy doesn't include pricing permissions</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

        </main>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <button id="backToTop" class="btn btn-primary rounded-circle position-fixed bottom-0 end-0 m-4 shadow fade p-3"
        style="display:none;">
        <i class="fa-solid fa-arrow-up"></i>
    </button>
    <script src="js/docs-nav.js" defer></script>
</body>

</html>