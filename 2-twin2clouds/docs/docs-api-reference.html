<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <title>API Reference â€” Twin2Clouds Documentation</title>
    <link rel="icon" type="image/x-icon" href="references/favicon.ico">
    <meta name="viewport" content="width=device-width,initial-scale=1" />

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link rel="stylesheet" href="css/docs_styles.css" />
</head>

<body>

    <div class="layout">
        <aside id="nav-placeholder"></aside>

        <main class="p-4">
            <h1 class="mb-3">
                <i class="fa-solid fa-server me-2"></i> API Reference
            </h1>

            <p class="text-muted mb-4">
                Complete reference for the Twin2Clouds REST API. The API is built with FastAPI and serves both the
                calculation engine and the web UI.
            </p>

            <!-- Calculation Endpoint -->
            <div class="card mb-4">
                <div class="card-body">
                    <h2 class="mb-3"><i class="fa-solid fa-calculator me-2"></i>Calculate Costs</h2>
                    <p><strong>Endpoint:</strong> <span class="badge bg-warning text-dark">PUT</span>
                        <code>/api/calculate</code>
                    </p>
                    <p>Calculates the cost breakdown for all providers and determines the cheapest configuration path.
                    </p>

                    <h4 class="mt-3">Request Body</h4>
                    <pre class="p-3 rounded"><code>{
  "numberOfDevices": 100,
  "deviceSendingIntervalInMinutes": 2.0,
  "averageSizeOfMessageInKb": 0.25,
  "hotStorageDurationInMonths": 1,
  "coolStorageDurationInMonths": 3,
  "archiveStorageDurationInMonths": 12,
  "needs3DModel": false,
  "entityCount": 0,
  "amountOfActiveEditors": 2,
  "amountOfActiveViewers": 10,
  "dashboardRefreshesPerHour": 4,
  "dashboardActiveHoursPerDay": 8,
  "currency": "USD",
  "useEventChecking": true,
  "triggerNotificationWorkflow": true,
  "returnFeedbackToDevice": false,
  "integrateErrorHandling": true,
  "orchestrationActionsPerMessage": 3,
  "eventsPerMessage": 1,
  "apiCallsPerDashboardRefresh": 1,
  "average3DModelSizeInMB": 100.0,
  "allowGcpSelfHostedL4": true,
  "allowGcpSelfHostedL5": true
}</code></pre>
                    <small class="text-muted">Note: <code>allowGcpSelfHostedL4</code> and
                        <code>allowGcpSelfHostedL5</code> control whether GCP's self-hosted Compute Engine solutions are
                        included in the L4/L5 optimization. Default is <code>true</code>.</small>

                    <h4 class="mt-3">Response Example</h4>
                    <pre class="p-3 rounded"><code>{
  "result": {
    "calculationResult": {
      "L1": "GCP",
      "L2": {"Hot": "AWS", "Cool": "GCP", "Archive": "AWS"},
      "L3": "AWS",
      "L4": "GCP",
      "L5": "GCP"
    },
    "cheapestPath": ["L1_GCP", "L2_AWS_Hot", "L2_GCP_Cool", "L2_AWS_Archive", "L3_AWS", "L4_GCP", "L5_GCP"],
    "awsCosts": { "dataAquisition": {...}, "dataProcessing": {...}, "resultHot": {...}, "resultL3Cool": {...}, "resultL3Archive": {...}, "resultL4": {...}, "resultL5": {...} },
    "azureCosts": { ... },
    "gcpCosts": { ... },
    "inputParamsUsed": { ... },
    "l2OptimizationOverride": null,
    "l4OptimizationOverride": null,
    "l2_l3_combinations": [ ... ],
    "currency": "USD"
  }
}</code></pre>
                </div>
            </div>

            <!-- Pricing & Data Endpoints -->
            <div class="card mb-4">
                <div class="card-body">
                    <h2 class="mb-3"><i class="fa-solid fa-database me-2"></i>Pricing & Data Endpoints</h2>
                    <p class="text-muted">Endpoints for managing the underlying data used for calculations, including
                        pricing files, region lists, and currency rates.</p>

                    <!-- Pricing Fetching -->
                    <h4 class="mt-4 text-primary"><i class="fa-solid fa-cloud-arrow-down me-2"></i>Pricing Fetching</h4>
                    <p>Triggers a fresh fetch of cloud provider pricing data. Results are cached for <strong>7
                            days</strong>.</p>

                    <div class="alert border mb-3">
                        <strong>Parameters:</strong>
                        <ul class="mb-0">
                            <li><code>force_fetch</code> (bool, default: false) - Ignore cache and force fresh fetch.
                            </li>
                            <li><code>additional_debug</code> (bool, default: false) - Enable verbose logging.</li>
                        </ul>
                    </div>

                    <table class="table table-hover table-bordered align-middle">
                        <thead>
                            <tr>
                                <th style="width: 100px;">Method</th>
                                <th style="width: 400px;">Endpoint</th>
                                <th>Description</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><span class="badge bg-primary">POST</span></td>
                                <td class="mono">/api/fetch_pricing/aws</td>
                                <td>Fetch latest AWS pricing data.</td>
                            </tr>
                            <tr>
                                <td><span class="badge bg-primary">POST</span></td>
                                <td class="mono">/api/fetch_pricing/azure</td>
                                <td>Fetch latest Azure pricing data.</td>
                            </tr>
                            <tr>
                                <td><span class="badge bg-primary">POST</span></td>
                                <td class="mono">/api/fetch_pricing/gcp</td>
                                <td>Fetch latest GCP pricing data.</td>
                            </tr>
                        </tbody>
                    </table>

                    <!-- File Status -->
                    <h4 class="mt-4 text-success"><i class="fa-solid fa-file-circle-check me-2"></i>File Status &
                        Validation</h4>
                    <p>Check the age and schema validity of cached data files.</p>
                    <table class="table table-hover table-bordered align-middle">
                        <thead>
                            <tr>
                                <th style="width: 100px;">Method</th>
                                <th style="width: 400px;">Endpoint</th>
                                <th>Description</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><span class="badge bg-success">GET</span></td>
                                <td class="mono">/api/pricing_age/aws</td>
                                <td>Returns age and validation status of AWS pricing file.</td>
                            </tr>
                            <tr>
                                <td><span class="badge bg-success">GET</span></td>
                                <td class="mono">/api/pricing_age/azure</td>
                                <td>Returns age and validation status of Azure pricing file.</td>
                            </tr>
                            <tr>
                                <td><span class="badge bg-success">GET</span></td>
                                <td class="mono">/api/pricing_age/gcp</td>
                                <td>Returns age and validation status of GCP pricing file.</td>
                            </tr>
                            <tr>
                                <td><span class="badge bg-success">GET</span></td>
                                <td class="mono">/api/regions_age/aws</td>
                                <td>Returns age of the AWS regions file.</td>
                            </tr>
                            <tr>
                                <td><span class="badge bg-success">GET</span></td>
                                <td class="mono">/api/regions_age/azure</td>
                                <td>Returns age of the Azure regions file.</td>
                            </tr>
                            <tr>
                                <td><span class="badge bg-success">GET</span></td>
                                <td class="mono">/api/regions_age/gcp</td>
                                <td>Returns age of the GCP regions file.</td>
                            </tr>
                        </tbody>
                    </table>

                    <h5 class="mt-3">Response Examples</h5>
                    <div class="row">
                        <div class="col-md-6">
                            <p class="text-muted small">Pricing Age Response:</p>
                            <pre class="p-3 rounded"><code>{
  "provider": "aws",
  "file_exists": true,
  "age": "2 days, 5 hours ago",
  "is_valid": true,
  "missing_keys": []
}</code></pre>
                        </div>
                        <div class="col-md-6">
                            <p class="text-muted small">Regions Age Response:</p>
                            <pre class="p-3 rounded"><code>{
  "provider": "aws",
  "file_exists": true,
  "age": "5 days, 12 hours ago"
}</code></pre>
                        </div>
                    </div>

                    <!-- Currency -->
                    <h4 class="mt-4 text-warning"><i class="fa-solid fa-coins me-2"></i>Currency</h4>
                    <p>Manage currency conversion rates (USD/EUR). Rates are cached for <strong>1 day</strong>.</p>
                    <table class="table table-hover table-bordered align-middle">
                        <thead>
                            <tr>
                                <th style="width: 100px;">Method</th>
                                <th style="width: 400px;">Endpoint</th>
                                <th>Description</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><span class="badge bg-success">GET</span></td>
                                <td class="mono">/api/currency_age</td>
                                <td>Returns age of the cached currency file.</td>
                            </tr>
                            <tr>
                                <td><span class="badge bg-primary">POST</span></td>
                                <td class="mono">/api/fetch_currency</td>
                                <td>Fetches fresh exchange rates from external API.</td>
                            </tr>
                        </tbody>
                    </table>

                    <!-- Region Fetching -->
                    <h4 class="mt-4 text-info"><i class="fa-solid fa-globe me-2"></i>Region Lists</h4>
                    <p>Force update the available regions list for a provider.
                        <br>Cache Duration: <strong>7 days</strong> (AWS/Azure), <strong>30 days</strong> (GCP).
                    </p>

                    <div class="alert alert-warning">
                        <i class="fa-solid fa-triangle-exclamation me-2"></i>
                        <strong>Warning:</strong> Fetching GCP regions takes about <strong>5-10 minutes</strong>!
                    </div>

                    <table class="table table-hover table-bordered align-middle">
                        <thead>
                            <tr>
                                <th style="width: 100px;">Method</th>
                                <th style="width: 400px;">Endpoint</th>
                                <th>Description</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><span class="badge bg-primary">POST</span></td>
                                <td class="mono">/api/fetch_regions/aws</td>
                                <td>Force fetch AWS regions list. Fast (~1-2 seconds).</td>
                            </tr>
                            <tr>
                                <td><span class="badge bg-primary">POST</span></td>
                                <td class="mono">/api/fetch_regions/azure</td>
                                <td>Force fetch Azure regions list. Fast (~1-2 seconds).</td>
                            </tr>
                            <tr>
                                <td><span class="badge bg-primary">POST</span></td>
                                <td class="mono">/api/fetch_regions/gcp</td>
                                <td>
                                    Force fetch GCP regions list. <strong>Very slow</strong> (5-10 minutes).
                                    <br><small class="text-muted">Iterates through all GCP services to check regional
                                        availability.</small>
                                </td>
                            </tr>
                        </tbody>
                    </table>

                </div>
            </div>

            <!-- Credential Validation Endpoints -->
            <div class="card mb-4">
                <div class="card-body">
                    <h2 class="mb-3"><i class="fa-solid fa-key me-2"></i>Credential Validation</h2>
                    <p class="text-muted">Verify that your cloud provider credentials are correctly configured and can
                        access pricing APIs.</p>

                    <div class="alert alert-info">
                        <i class="fa-solid fa-circle-info me-2"></i>
                        <strong>Note:</strong> Azure Pricing API is publicly accessible - credentials are validated for
                        configuration completeness only.
                    </div>

                    <table class="table table-hover table-bordered align-middle">
                        <thead>
                            <tr>
                                <th style="width: 100px;">Method</th>
                                <th style="width: 400px;">Endpoint</th>
                                <th>Description</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><span class="badge bg-success">GET</span></td>
                                <td class="mono">/api/credentials/check/aws</td>
                                <td>Validate AWS credentials from config file. Checks STS identity and Pricing API
                                    access.</td>
                            </tr>
                            <tr>
                                <td><span class="badge bg-primary">POST</span></td>
                                <td class="mono">/api/credentials/check/aws</td>
                                <td>Validate AWS credentials from request body.</td>
                            </tr>
                            <tr>
                                <td><span class="badge bg-success">GET</span></td>
                                <td class="mono">/api/credentials/check/gcp</td>
                                <td>Validate GCP service account credentials and Cloud Billing API access.</td>
                            </tr>
                            <tr>
                                <td><span class="badge bg-primary">POST</span></td>
                                <td class="mono">/api/credentials/check/gcp</td>
                                <td>Validate GCP credentials from request body.</td>
                            </tr>
                            <tr>
                                <td><span class="badge bg-success">GET</span></td>
                                <td class="mono">/api/credentials/check/azure</td>
                                <td>Validate Azure configuration from config file.</td>
                            </tr>
                            <tr>
                                <td><span class="badge bg-primary">POST</span></td>
                                <td class="mono">/api/credentials/check/azure</td>
                                <td>Validate Azure configuration from request body.</td>
                            </tr>
                        </tbody>
                    </table>

                    <h4 class="mt-4">Response Format</h4>
                    <pre class="p-3 rounded"><code>{
  "provider": "aws",
  "status": "valid",
  "message": "AWS credentials are valid and can access Pricing API",
  "config_present": true,
  "credentials_valid": true,
  "can_fetch_pricing": true,
  "identity": {
    "account": "123456789012",
    "arn": "arn:aws:iam::123456789012:user/example"
  }
}</code></pre>
                </div>
            </div>

        </main>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <button id="backToTop" class="btn btn-primary rounded-circle position-fixed bottom-0 end-0 m-4 shadow fade p-3"
        style="display:none;">
        <i class="fa-solid fa-arrow-up"></i>
    </button>
    <script src="js/docs-nav.js" defer></script>
</body>

</html>