<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <title>Project Structure — Twin2Clouds Documentation</title>
    <link rel="icon" type="image/x-icon" href="references/favicon.ico">
    <meta name="viewport" content="width=device-width,initial-scale=1" />

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link rel="stylesheet" href="css/docs_styles.css" />
</head>

<body>

    <div class="layout">
        <aside id="nav-placeholder"></aside>

        <main class="p-4">
            <h1 class="mb-3">
                <i class="fa-solid fa-folder-tree me-2"></i> Project Structure
            </h1>

            <p class="text-muted mb-4">
                Overview of the Twin2Clouds codebase organization and key components.
            </p>

            <!-- Directory Structure -->
            <div class="card mb-4">
                <div class="card-body">
                    <h2 class="mb-3"><i class="fa-solid fa-folder-open me-2"></i>Directory Structure</h2>
                    <img src="references/project_structure_diagram_1763756022092.png" alt="Project Structure Diagram"
                        class="img-fluid rounded shadow" style="max-width: 100%;">
                </div>
            </div>

            <!-- Core Directories -->
            <div class="card mb-4">
                <div class="card-body">
                    <h2 class="mb-3"><i class="fa-solid fa-diagram-project me-2"></i>Core Directories</h2>

                    <h3 class="mt-3 mb-2"><code>backend/</code> - Python Backend</h3>
                    <p>Contains all Python modules for cost calculation, pricing fetching, and utilities.</p>

                    <h4 class="mt-3"><code>backend/calculation/</code> - Cost Calculation Engine</h4>
                    <ul>
                        <li><code><strong>engine.py</strong></code> - Main calculation orchestrator, determines optimal
                            cloud provider per layer</li>
                        <li><code><strong>decision.py</strong></code> - Graph-based path-finding algorithm for storage
                            tier
                            optimization</li>
                        <li><code><strong>aws.py</strong></code> - AWS-specific cost formulas (IoT Core, DynamoDB,
                            Lambda,
                            S3, TwinMaker, Grafana)</li>
                        <li><code><strong>azure.py</strong></code> - Azure-specific cost formulas (IoT Hub, CosmosDB,
                            Functions, Blob Storage, Digital Twins, Grafana)</li>
                        <li><code><strong>gcp.py</strong></code> - GCP-specific cost formulas (IoT Core, Firestore,
                            Cloud
                            Functions, Cloud Storage)</li>
                        <li><code><strong>transfer.py</strong></code> - Data transfer and egress cost calculations
                            between
                            providers and tiers</li>
                    </ul>

                    <h4 class="mt-3"><code>backend/fetch_data/</code> - Dynamic Data Fetching</h4>
                    <ul>
                        <li><code><strong>initial_fetch_aws.py</strong></code> - Fetches AWS region lists with 7-day
                            caching
                        </li>
                        <li><code><strong>initial_fetch_azure.py</strong></code> - Fetches Azure region lists with 7-day
                            caching</li>
                        <li><code><strong>initial_fetch_google.py</strong></code> - Fetches GCP region lists with 7-day
                            caching</li>
                        <li><code><strong>cloud_price_fetcher_aws.py</strong></code> - AWS Pricing API integration using
                            boto3</li>
                        <li><code><strong>cloud_price_fetcher_azure.py</strong></code> - Azure Retail Prices API
                            integration
                        </li>
                        <li><code><strong>cloud_price_fetcher_google.py</strong></code> - GCP Cloud Billing Catalog API
                            integration</li>
                        <li><code><strong>calculate_up_to_date_pricing.py</strong></code> - Orchestrates pricing fetches
                            from all providers</li>
                    </ul>

                    <h4 class="mt-3">Core Utilities</h4>
                    <ul>
                        <li><code><strong>pricing_utils.py</strong></code> - Currency conversion (USD/EUR) and schema
                            validation</li>
                        <li><code><strong>config_loader.py</strong></code> - Loads configuration and credential files
                        </li>
                        <li><code><strong>constants.py</strong></code> - File paths and system constants</li>
                        <li><code><strong>utils.py</strong></code> - File freshness checking, caching utilities</li>
                        <li><code><strong>logger.py</strong></code> - Logging configuration</li>
                    </ul>

                    <h3 class="mt-4 mb-2"><code>json/</code> - Pricing Data</h3>
                    <h4><code>json/fetched_data/</code></h4>
                    <ul>
                        <li><code><strong>pricing_aws.json</strong></code> - Cached AWS pricing data (7-day TTL)</li>
                        <li><code><strong>pricing_azure.json</strong></code> - Cached Azure pricing data (7-day TTL)
                        </li>
                        <li><code><strong>pricing_gcp.json</strong></code> - Cached GCP pricing data (7-day TTL)</li>
                        <li><code><strong>currency.json</strong></code> - Cached USD/EUR exchange rates (1-day TTL)</li>
                        <li><code><strong>aws_regions.json</strong></code> - AWS region mapping (7-day TTL)</li>
                        <li><code><strong>azure_regions.json</strong></code> - Azure region mapping (7-day TTL)</li>
                        <li><code><strong>gcp_regions.json</strong></code> - GCP region mapping (7-day TTL)</li>
                    </ul>

                    <h3 class="mt-4 mb-2"><code>config/</code> - Configuration</h3>
                    <ul>
                        <li><code><strong>config_credentials.json</strong></code> - Cloud provider credentials (AWS,
                            Azure,
                            GCP)</li>
                        <li><code><strong>service_calc_params.json</strong></code> - Service configuration parameters
                        </li>
                        <li><code><strong>service_mapping.json</strong></code> - Maps neutral service names to
                            provider-specific names</li>
                    </ul>

                    <h3 class="mt-4 mb-2"><code>docs/</code> - Documentation</h3>
                    <ul>
                        <li><code><strong>docs-overview.html</strong></code> - Documentation landing page</li>
                        <li><code><strong>docs-setup-usage.html</strong></code> - Setup and usage guide</li>
                        <li><code><strong>docs-architecture.html</strong></code> - Architecture overview</li>
                        <li><code><strong>docs-project-structure.html</strong></code> - This document</li>
                        <li><code><strong>docs-aws-pricing.html</strong></code> - AWS pricing schema details</li>
                        <li><code><strong>docs-formulas.html</strong></code> - Cost formula documentation</li>
                    </ul>

                    <h3 class="mt-4 mb-2"><code>js/</code> - Frontend JavaScript</h3>
                    <ul>
                        <li><code><strong>api-client.js</strong></code> - REST API client, form handling, result display
                        </li>
                        <li><code><strong>calculation/ui.js</strong></code> - UI interaction handlers</li>
                        <li><code><strong>docs-nav.js</strong></code> - Navigation for documentation pages</li>
                    </ul>

                    <h3 class="mt-4 mb-2"><code>css/</code> - Stylesheets</h3>
                    <ul>
                        <li><code><strong>styles.css</strong></code> - Main application styles</li>
                        <li><code><strong>docs_styles.css</strong></code> - Documentation page styles</li>
                    </ul>
                </div>
            </div>

            <!-- Key Files -->
            <div class="card mb-4">
                <div class="card-body">
                    <h2 class="mb-3"><i class="fa-solid fa-file-code me-2"></i>Key Files</h2>

                    <h3 class="mb-2"><code>rest_api.py</code> - FastAPI Backend</h3>
                    <p>Main application entry point. Defines the REST API endpoints:</p>
                    <ul>
                        <li><code>PUT /calculate</code> - Calculate optimal cloud configuration</li>
                        <li><code>POST /pricing/fetch/{provider}</code> - Fetch provider pricing</li>
                        <li><code>GET /file-status/pricing/{provider}</code> - Check pricing file status</li>
                        <li><code>GET /file-status/currency</code> - Check currency file status</li>
                        <li><code>GET /ui</code> - Serve web interface</li>
                        <li><code>GET /docs</code> - Swagger API documentation</li>
                    </ul>

                    <h3 class="mt-4 mb-2"><code>index.html</code> - Web UI</h3>
                    <p>Single-page web interface for configuring scenarios and viewing results. Features:</p>
                    <ul>
                        <li>Currency selector (USD/EUR)</li>
                        <li>Scenario presets (Smart Home, Industrial Facility, Large Building)</li>
                        <li>Interactive input forms for all layers</li>
                        <li>Visual cost comparison cards with provider breakdown</li>
                    </ul>

                    <h3 class="mt-4 mb-2"><code>Dockerfile</code></h3>
                    <p>Container definition for deploying the application. Uses Python 3.9 slim image, installs
                        dependencies, and exposes port 5003.</p>
                </div>
            </div>

            <!-- Data Flow -->
            <div class="card mb-4">
                <div class="card-body">
                    <h2 class="mb-3"><i class="fa-solid fa-diagram-next me-2"></i>Code Flow</h2>

                    <h3 class="mb-2">Calculation Request Flow</h3>
                    <ol>
                        <li>User submits parameters via web UI or API → <code>index.html</code> /
                            <code>api-client.js</code>
                        </li>
                        <li>Request received by FastAPI → <code>rest_api.py</code> <code>calc()</code> endpoint</li>
                        <li>Parameters passed to calculation engine → <code>backend/calculation/engine.py</code>
                            <code>calculate_cheapest_costs()</code>
                        </li>
                        <li>Pricing data loaded → <code>json/fetched_data/pricing_*.json</code></li>
                        <li>Cost calculated for each provider:
                            <ul>
                                <li><code>calculate_aws_costs()</code> → calls <code>backend/calculation/aws.py</code>
                                    formulas
                                </li>
                                <li><code>calculate_azure_costs()</code> → calls
                                    <code>backend/calculation/azure.py</code>
                                    formulas
                                </li>
                                <li><code>calculate_gcp_costs()</code> → calls <code>backend/calculation/gcp.py</code>
                                    formulas
                                </li>
                            </ul>
                        </li>
                        <li>Transfer costs calculated → <code>backend/calculation/transfer.py</code></li>
                        <li>Optimal path determined → <code>backend/calculation/decision.py</code> graph algorithm</li>
                        <li>Currency conversion applied (if EUR) → <code>backend/pricing_utils.py</code></li>
                        <li>Results returned to user → JSON response displayed in UI</li>
                    </ol>

                    <h3 class="mt-4 mb-2">Pricing Fetch Flow</h3>
                    <ol>
                        <li>User or system triggers pricing fetch → <code>POST /pricing/fetch/{provider}</code></li>
                        <li>Check cache freshness → <code>backend/utils.py</code> <code>is_file_fresh()</code></li>
                        <li>If stale, fetch new pricing →
                            <code>backend/fetch_data/calculate_up_to_date_pricing.py</code>
                        </li>
                        <li>Fetch from specific provider:
                            <ul>
                                <li>AWS → <code>cloud_price_fetcher_aws.py</code> (boto3 Pricing API)</li>
                                <li>Azure → <code>cloud_price_fetcher_azure.py</code> (Retail Prices API)</li>
                                <li>GCP → <code>cloud_price_fetcher_google.py</code> (Cloud Billing Catalog API)</li>
                            </ul>
                        </li>
                        <li>Validate schema → <code>backend/pricing_utils.py</code>
                            <code>validate_pricing_schema()</code>
                        </li>
                        <li>Save to cache → <code>json/fetched_data/pricing_{provider}.json</code></li>
                    </ol>
                </div>
            </div>

            <!-- Development Notes -->
            <div class="card mb-4">
                <div class="card-body">
                    <h2 class="mb-3"><i class="fa-solid fa-code me-2"></i>Development Notes</h2>

                    <h3 class="mb-2">Adding a New Cloud Provider</h3>
                    <ol>
                        <li>Create <code>backend/calculation/[provider].py</code> with cost formulas</li>
                        <li>Create <code>backend/fetch_data/cloud_price_fetcher_[provider].py</code> for pricing API
                            integration</li>
                        <li>Add provider to <code>backend/fetch_data/calculate_up_to_date_pricing.py</code></li>
                        <li>Update <code>backend/calculation/engine.py</code> to include provider in optimization</li>
                        <li>Add provider credentials to <code>config/config_credentials.json</code></li>
                    </ol>

                    <h3 class="mt-4 mb-2">Adding a New Service/Layer</h3>
                    <ol>
                        <li>Define cost formula in appropriate <code>backend/calculation/[provider].py</code> files</li>
                        <li>Add service to <code>config/service_mapping.json</code></li>
                        <li>Add pricing fetcher logic to <code>cloud_price_fetcher_[provider].py</code></li>
                        <li>Update <code>calculate_up_to_date_pricing.py</code> schema builder</li>
                        <li>Modify <code>engine.py</code> to include in optimization logic</li>
                        <li>Add UI inputs to <code>index.html</code> and <code>api-client.js</code></li>
                    </ol>

                    <h3 class="mt-4 mb-2">Caching Strategy</h3>
                    <p>The application uses file-based caching with TTL (Time To Live):</p>
                    <ul>
                        <li><strong>7-day cache:</strong> Pricing data, region lists (stable data)</li>
                        <li><strong>1-day cache:</strong> Currency exchange rates (more volatile)</li>
                        <li>Cache validation uses file modification timestamps via <code>utils.is_file_fresh()</code>
                        </li>
                        <li>Cache files are stored in <code>json/fetched_data/</code></li>
                    </ul>
                </div>
            </div>

        </main>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <button id="backToTop" class="btn btn-primary rounded-circle position-fixed bottom-0 end-0 m-4 shadow fade p-3"
        style="display:none;">
        <i class="fa-solid fa-arrow-up"></i>
    </button>
    <script src="js/docs-nav.js" defer></script>
</body>

</html>