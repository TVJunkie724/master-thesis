<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <title>GCP Credentials Setup — Twin2Clouds Documentation</title>
    <link rel="icon" type="image/x-icon" href="references/favicon.ico">
    <meta name="viewport" content="width=device-width,initial-scale=1" />

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link rel="stylesheet" href="css/docs_styles.css" />
</head>

<body>

    <div class="layout">
        <aside id="nav-placeholder"></aside>

        <main class="p-4">
            <h1 class="mb-3">
                <i class="fa-brands fa-google me-2"></i> GCP Credentials Setup
            </h1>

            <p class="text-muted mb-4">
                Configure GCP Service Account credentials for fetching pricing data from the Cloud Billing Catalog API.
            </p>

            <!-- Breadcrumb -->
            <nav aria-label="breadcrumb" class="mb-4">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="docs-credentials-setup.html">Credentials Setup</a></li>
                    <li class="breadcrumb-item active" aria-current="page">GCP</li>
                </ol>
            </nav>

            <div class="card mb-4" id="overview">
                <div class="card-body">
                    <h2 class="mb-3"><i class="fa-solid fa-circle-info me-2"></i>About GCP Pricing API</h2>

                    <div class="callout success">
                        <strong><i class="fa-solid fa-check-circle me-2"></i>Good News!</strong>
                        The <strong>Cloud Billing Catalog API</strong> returns public pricing data and doesn't require
                        any special IAM roles. You just need a valid Service Account to authenticate API requests.
                    </div>

                    <p>The Cloud Billing Catalog API provides:</p>
                    <ul>
                        <li><strong>Services list</strong> - All GCP services with pricing</li>
                        <li><strong>SKUs list</strong> - Detailed pricing for each service (Compute Engine, Cloud
                            Functions,
                            etc.)</li>
                    </ul>

                    <p>This is simpler than AWS or Azure because:</p>
                    <ul>
                        <li>No special IAM roles or permissions required</li>
                        <li>Any valid service account can access pricing data</li>
                        <li>Data is publicly available (authentication just prevents abuse)</li>
                    </ul>
                </div>
            </div>

            <!-- Table of Contents -->
            <div class="card mb-4">
                <div class="card-body">
                    <h2 class="mb-3"><i class="fa-solid fa-list me-2"></i>Contents</h2>
                    <ul>
                        <li><a href="#step1">Step 1: Create a GCP Project</a></li>
                        <li><a href="#step2">Step 2: Enable Cloud Billing API</a></li>
                        <li><a href="#step3">Step 3: Create a Service Account</a></li>
                        <li><a href="#step4">Step 4: Download JSON Key</a></li>
                        <li><a href="#step5">Step 5: Configure Credentials</a></li>
                        <li><a href="#step6">Step 6: Verify Setup</a></li>
                    </ul>
                </div>
            </div>

            <div class="card mb-4" id="step1">
                <div class="card-body">
                    <h2 class="mb-3">Step 1: Create a GCP Project</h2>

                    <p>If you don't already have a GCP project, create one:</p>

                    <h5 class="mt-3"><i class="fa-solid fa-display me-2"></i>Option A: Google Cloud Console (GUI)</h5>
                    <ol>
                        <li>Go to the <a href="https://console.cloud.google.com/projectcreate" target="_blank">Create
                                Project</a> page</li>
                        <li>Enter a project name (e.g., <code>twin2clouds-optimizer</code>)</li>
                        <li>Click <strong>Create</strong></li>
                        <li>Note the <strong>Project ID</strong> (you'll need this later)</li>
                    </ol>

                    <h5 class="mt-4"><i class="fa-solid fa-terminal me-2"></i>Option B: gcloud CLI</h5>
                    <pre class="p-3 rounded"><code># Create a new project
gcloud projects create twin2clouds-optimizer --name="Twin2Clouds Optimizer"

# Set it as your active project
gcloud config set project twin2clouds-optimizer</code></pre>

                    <div class="callout info mt-3">
                        <strong><i class="fa-solid fa-lightbulb me-2"></i>Use Existing Project</strong>
                        You can also use an existing GCP project. Any project with the Cloud Billing API enabled will
                        work.
                    </div>
                </div>
            </div>

            <div class="card mb-4" id="step2">
                <div class="card-body">
                    <h2 class="mb-3">Step 2: Enable Cloud Billing API</h2>

                    <p>The Cloud Billing Catalog API must be enabled for your project:</p>

                    <h5 class="mt-3"><i class="fa-solid fa-display me-2"></i>Option A: Google Cloud Console (GUI)</h5>
                    <ol>
                        <li>Go to <a href="https://console.cloud.google.com/apis/library/cloudbilling.googleapis.com"
                                target="_blank">Cloud Billing API</a> in the API Library</li>
                        <li>Select your project from the dropdown</li>
                        <li>Click <strong>Enable</strong></li>
                    </ol>

                    <h5 class="mt-4"><i class="fa-solid fa-terminal me-2"></i>Option B: gcloud CLI</h5>
                    <pre class="p-3 rounded"><code># Enable the Cloud Billing API
gcloud services enable cloudbilling.googleapis.com</code></pre>
                </div>
            </div>

            <div class="card mb-4" id="step3">
                <div class="card-body">
                    <h2 class="mb-3">Step 3: Create a Service Account</h2>

                    <h5 class="mt-3"><i class="fa-solid fa-display me-2"></i>Option A: Google Cloud Console (GUI)</h5>
                    <ol>
                        <li>Go to <a href="https://console.cloud.google.com/iam-admin/serviceaccounts"
                                target="_blank">Service Accounts</a></li>
                        <li>Click <strong>Create Service Account</strong></li>
                        <li>Enter a name (e.g., <code>twin2clouds-pricing</code>)</li>
                        <li>Enter a description (e.g., "Service account for Twin2Clouds pricing API access")</li>
                        <li>Click <strong>Create and Continue</strong></li>
                        <li><strong>Skip</strong> the "Grant access" step (no roles needed for Cloud Billing Catalog)
                        </li>
                        <li>Click <strong>Done</strong></li>
                    </ol>

                    <h5 class="mt-4"><i class="fa-solid fa-terminal me-2"></i>Option B: gcloud CLI</h5>
                    <pre class="p-3 rounded"><code># Create a service account
gcloud iam service-accounts create twin2clouds-pricing \
    --display-name="Twin2Clouds Pricing" \
    --description="Service account for Twin2Clouds pricing API access"</code></pre>

                    <div class="callout info mt-3">
                        <strong><i class="fa-solid fa-shield-halved me-2"></i>No Roles Needed</strong>
                        Unlike other GCP APIs, the Cloud Billing Catalog API doesn't require any IAM roles.
                        The service account just needs to exist and be properly authenticated.
                    </div>
                </div>
            </div>

            <div class="card mb-4" id="step4">
                <div class="card-body">
                    <h2 class="mb-3">Step 4: Download JSON Key</h2>

                    <h5 class="mt-3"><i class="fa-solid fa-display me-2"></i>Option A: Google Cloud Console (GUI)</h5>
                    <ol>
                        <li>Go to <a href="https://console.cloud.google.com/iam-admin/serviceaccounts"
                                target="_blank">Service Accounts</a></li>
                        <li>Click on your service account (e.g., <code>twin2clouds-pricing</code>)</li>
                        <li>Go to the <strong>Keys</strong> tab</li>
                        <li>Click <strong>Add Key</strong> → <strong>Create new key</strong></li>
                        <li>Select <strong>JSON</strong> format</li>
                        <li>Click <strong>Create</strong></li>
                        <li>Save the downloaded file securely</li>
                    </ol>

                    <h5 class="mt-4"><i class="fa-solid fa-terminal me-2"></i>Option B: gcloud CLI</h5>
                    <pre class="p-3 rounded"><code># Create and download a JSON key
gcloud iam service-accounts keys create ~/gcp-credentials.json \
    --iam-account=twin2clouds-pricing@YOUR_PROJECT_ID.iam.gserviceaccount.com</code></pre>

                    <div class="callout warn mt-3">
                        <strong><i class="fa-solid fa-exclamation-triangle me-2"></i>Security Warning</strong>
                        The JSON key file contains sensitive credentials. Store it securely and never commit it to
                        version control! The <code>config/</code> directory is in <code>.gitignore</code>.
                    </div>
                </div>
            </div>

            <div class="card mb-4" id="step5">
                <div class="card-body">
                    <h2 class="mb-3">Step 5: Configure Credentials</h2>

                    <p>Place your service account JSON file in the config directory:</p>

                    <pre class="p-3 rounded"><code># Copy the JSON key to the config directory
# The expected path is: config/gcp-credentials.json

cp ~/gcp-credentials.json config/gcp-credentials.json</code></pre>

                    <p class="mt-3">Then update <code>config/config_credentials.json</code>:</p>
                    <pre class="p-3 rounded"><code>{
  "google": {
    "gcp_project_id": "your-project-id",
    "gcp_region": "europe-west1"
  }
}</code></pre>

                    <div class="callout info mt-3">
                        <strong><i class="fa-solid fa-file me-2"></i>Credential File Path</strong>
                        The service account JSON file should be placed at <code>config/gcp-credentials.json</code>.
                        This path is configured in the application constants and mounted in Docker.
                    </div>
                </div>
            </div>

            <div class="card mb-4" id="step6">
                <div class="card-body">
                    <h2 class="mb-3">Step 6: Verify Setup</h2>

                    <p>Use the built-in credential checker to verify your setup:</p>
                    <pre class="p-3 rounded"><code># REST API
GET /permissions/verify/gcp

# Or using cURL
curl http://localhost:5003/permissions/verify/gcp</code></pre>

                    <h5 class="mt-4">Expected Response (Success)</h5>
                    <pre class="p-3 rounded"><code>{
  "provider": "gcp",
  "status": "valid",
  "message": "GCP credentials are valid and can access Cloud Billing Catalog API",
  "config_present": true,
  "credentials_valid": true,
  "can_fetch_pricing": true,
  "identity": {
    "project_id": "your-project-id",
    "service_account_email": "twin2clouds-pricing@your-project-id.iam.gserviceaccount.com"
  }
}</code></pre>

                    <h5 class="mt-4">Common Issues</h5>
                    <table class="table table-sm">
                        <thead>
                            <tr>
                                <th>Error</th>
                                <th>Solution</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><code>File not found</code></td>
                                <td>Check that <code>gcp-credentials.json</code> is in the <code>config/</code>
                                    directory
                                </td>
                            </tr>
                            <tr>
                                <td><code>Invalid JSON</code></td>
                                <td>Ensure the JSON key file is valid and not corrupted</td>
                            </tr>
                            <tr>
                                <td><code>API not enabled</code></td>
                                <td>Enable the Cloud Billing API for your project (Step 2)</td>
                            </tr>
                            <tr>
                                <td><code>403 Forbidden</code></td>
                                <td>The Cloud Billing API may not be enabled for your project</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

        </main>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <button id="backToTop" class="btn btn-primary rounded-circle position-fixed bottom-0 end-0 m-4 shadow fade p-3"
        style="display:none;">
        <i class="fa-solid fa-arrow-up"></i>
    </button>
    <script src="js/docs-nav.js" defer></script>
</body>

</html>