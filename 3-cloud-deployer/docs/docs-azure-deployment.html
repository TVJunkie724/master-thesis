<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <title>Azure Deployment Guide — Deployer Documentation</title>
    <link rel="icon" type="image/x-icon" href="references/favicon.ico">
    <meta name="viewport" content="width=device-width,initial-scale=1" />

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link rel="stylesheet" href="css/docs_styles.css" />
</head>

<body>

    <div class="layout">
        <aside id="nav-placeholder"></aside>

        <main class="p-4">
            <h1 class="mb-3">
                <i class="fa-brands fa-microsoft me-2"></i> Azure Deployment Guide
            </h1>

            <p class="text-muted mb-4">
                Guide to deploying Digital Twin layers on Microsoft Azure (in development).
            </p>

            <div class="callout info mb-4">
                <strong><i class="fa-solid fa-circle-half-stroke me-2"></i>Status: Partially Complete</strong>
                <br>
                <strong>Complete:</strong> Setup Layer (Resource Group, Managed Identity, Storage), L0 (Multi-cloud
                Glue), L1 (IoT Hub, Event Grid, Functions).
                <br>
                <strong>In Progress:</strong> L2-L5 deployment layers.
            </div>

            <!-- Table of Contents -->
            <div class="card mb-4">
                <div class="card-body">
                    <h2 class="mb-3"><i class="fa-solid fa-list me-2"></i>Table of Contents</h2>
                    <div class="row">
                        <div class="col-md-6">
                            <ul>
                                <li><a href="#azure-services">Planned Azure Services</a></li>
                                <li><a href="#roadmap">Implementation Roadmap</a></li>
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <ul>
                                <li><a href="#technical-specs">Technical Specifications</a></li>
                                <li><a href="#future-work">Future Work</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card mb-4" id="azure-services">
                <h2 class="mb-3"><i class="fa-solid fa-cloud me-2"></i>Planned Azure Services</h2>
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>Layer</th>
                            <th>Service</th>
                            <th>Purpose</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>L1 - Data Acquisition</td>
                            <td>Azure IoT Hub</td>
                            <td>Device connectivity, message routing</td>
                        </tr>
                        <tr>
                            <td>L2 - Data Processing</td>
                            <td>Azure Functions</td>
                            <td>Dispatcher, processors, persister functions</td>
                        </tr>
                        <tr>
                            <td>L3 - Hot Storage</td>
                            <td>Azure Cosmos DB</td>
                            <td>Recent data with low-latency access</td>
                        </tr>
                        <tr>
                            <td>L3 - Cool Storage</td>
                            <td>Blob Storage (Cool Tier)</td>
                            <td>Historical data accessed occasionally</td>
                        </tr>
                        <tr>
                            <td>L3 - Archive Storage</td>
                            <td>Blob Storage (Archive Tier)</td>
                            <td>Long-term archival data</td>
                        </tr>
                        <tr>
                            <td>L3 - Data Access</td>
                            <td>Azure API Management</td>
                            <td>External access to hot data (for TwinMaker)</td>
                        </tr>
                        <tr>
                            <td>L4 - Twin Management</td>
                            <td>Azure Digital Twins</td>
                            <td>Digital twin models and queries</td>
                        </tr>
                        <tr>
                            <td>L5 - Visualization</td>
                            <td>Azure Managed Grafana</td>
                            <td>Dashboards and monitoring</td>
                        </tr>
                        <tr>
                            <td>Supporting</td>
                            <td>Azure Active Directory</td>
                            <td>Access control and identity management</td>
                        </tr>
                        <tr>
                            <td>Supporting</td>
                            <td>Event Grid</td>
                            <td>Event routing and reactive messaging</td>
                        </tr>
                        <tr>
                            <td>Supporting</td>
                            <td>Logic Apps</td>
                            <td>Workflow orchestration and scheduling</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="card mb-4" id="roadmap">
                <h2 class="mb-3"><i class="fa-solid fa-road me-2"></i>Implementation Roadmap</h2>
                <p>The Azure deployer implementation follows a modular, layer-by-layer approach, strictly aligned with
                    the AWS architecture:</p>

                <div class="roadmap-content">
                    <!-- Layer 1 -->
                    <h3 class="mt-4 text-primary">Layer 1: Data Acquisition (IoT Hub)</h3>
                    <ul>
                        <li><span class="badge text-bg-success">Complete</span> <strong>Resource Group:</strong>
                            <ul>
                                <li><strong>Create:</strong> Dedicated Resource Group (e.g., <code>rg-twin-dev</code>).
                                </li>
                                <li><strong>Purpose:</strong> Logical container for all twin resources.</li>
                            </ul>
                        </li>
                        <li><span class="badge text-bg-success">Complete</span> <strong>IoT Hub:</strong>
                            <ul>
                                <li><strong>Create:</strong> IoT Hub (Standard Tier S1).</li>
                                <li><strong>Interaction:</strong> Provides connection strings for devices.</li>
                            </ul>
                        </li>
                        <li><span class="badge text-bg-success">Complete</span> <strong>Event Grid Routing:</strong>
                            <ul>
                                <li><strong>Create:</strong> Event Grid System Topic for IoT Hub.</li>
                                <li><strong>Action:</strong> Configure Message Routing to send telemetry to Event Grid.
                                </li>
                            </ul>
                        </li>
                        <li><span class="badge text-bg-success">Complete</span> <strong>Dispatcher Function:</strong>
                            <ul>
                                <li><strong>Trigger:</strong> Event Grid Trigger (subscribes to IoT Hub events).</li>
                                <li><strong>Single Cloud:</strong> Routes incoming telemetry to local processor
                                    functions.</li>
                                <li><strong>Multi Cloud:</strong> Routes messages to a local <strong>Connector
                                        Function</strong> if the processor is on another cloud.</li>
                            </ul>
                        </li>
                        <li><span class="badge text-bg-success">Complete</span> <strong>Connector Function [Multi-Cloud
                                Only]:</strong>
                            <ul>
                                <li><strong>Created:</strong> Only if Layer 2 is on a different cloud provider.</li>
                                <li><strong>Logic:</strong> Masquerades as a processor function. Wraps the event and
                                    sends it via HTTP POST to the remote cloud's Ingestion API.</li>
                            </ul>
                        </li>
                        <li><span class="badge text-bg-success">Complete</span> <strong>Ingestion Function [Multi-Cloud
                                Only]:</strong>
                            <ul>
                                <li><strong>Created:</strong> Only if Layer 1 is on a different cloud provider.</li>
                                <li><strong>Trigger:</strong> HTTP Trigger.</li>
                                <li><strong>Logic:</strong> Receives events from a remote Connector and invokes the
                                    local Processor function.</li>
                            </ul>
                        </li>
                    </ul>

                    <!-- Layer 2 -->
                    <h3 class="mt-4 text-primary">Layer 2: Data Processing (Functions)</h3>
                    <ul>
                        <li><span class="badge text-bg-warning">Todo</span> <strong>Function App:</strong>
                            <ul>
                                <li><strong>Create:</strong> Function App (Consumption Plan, Python v2).</li>
                                <li><strong>Identity:</strong> Enable <strong>System-Assigned Managed Identity</strong>.
                                </li>
                            </ul>
                        </li>
                        <li><span class="badge text-bg-warning">Todo</span> <strong>Persister Function:</strong>
                            <ul>
                                <li><strong>Single Cloud:</strong> Writes cleaned data to Cosmos DB using SDK.</li>
                                <li><strong>Multi Cloud:</strong> Sends data via HTTP POST to the remote cloud's
                                    <strong>Writer API</strong> (if L3 is remote).
                                </li>
                                <li><strong>Interaction:</strong> Invokes <strong>Event Checker</strong> function (if
                                    enabled).</li>
                            </ul>
                        </li>
                        <li><span class="badge text-bg-warning">Todo</span> <strong>Event Checker Function
                                [Optional]:</strong>
                            <ul>
                                <li><strong>Trigger:</strong> HTTP/Direct Invocation from Persister.</li>
                                <li><strong>Logic:</strong> Detects anomalies (e.g., temp > threshold).</li>
                                <li><strong>Interaction:</strong> Triggers <strong>Logic App</strong> workflow.</li>
                            </ul>
                        </li>
                    </ul>

                    <!-- Layer 3 -->
                    <h3 class="mt-4 text-primary">Layer 3: Storage & Access (Cosmos, Blob, APIM)</h3>
                    <ul>
                        <li><span class="badge text-bg-warning">Todo</span> <strong>Cosmos DB (Hot):</strong>
                            <ul>
                                <li><strong>Create:</strong> Azure Cosmos DB for NoSQL account.</li>
                                <li><strong>Container:</strong> Create <code>HotData</code> container.</li>
                            </ul>
                        </li>
                        <li><span class="badge text-bg-warning">Todo</span> <strong>Writer Function [Multi-Cloud
                                Only]:</strong>
                            <ul>
                                <li><strong>Created:</strong> Only if Layer 2 is on a different cloud provider.</li>
                                <li><strong>Trigger:</strong> HTTP Trigger.</li>
                                <li><strong>Logic:</strong> Receives JSON data from a remote Persister and writes it to
                                    Cosmos DB.</li>
                            </ul>
                        </li>
                        <li><span class="badge text-bg-warning">Todo</span> <strong>Blob Storage
                                (Cool/Archive):</strong>
                            <ul>
                                <li><strong>Create:</strong> Storage Account (Standard_LRS).</li>
                                <li><strong>Containers:</strong> Create <code>cool-storage</code> and
                                    <code>archive-storage</code>.
                                </li>
                            </ul>
                        </li>
                        <li><span class="badge text-bg-warning">Todo</span> <strong>Hot-to-Cold Mover:</strong>
                            <ul>
                                <li><strong>Type:</strong> Timer Trigger Function (runs daily).</li>
                                <li><strong>Action:</strong> Query old data from Cosmos DB -> Write to
                                    <code>cool-storage</code> -> Delete from Cosmos.
                                </li>
                            </ul>
                        </li>
                        <li><span class="badge text-bg-warning">Todo</span> <strong>Cold-to-Archive Mover:</strong>
                            <ul>
                                <li><strong>Type:</strong> Timer Trigger Function (runs daily).</li>
                                <li><strong>Action:</strong> Move objects from <code>cool-storage</code> to
                                    <code>archive-storage</code>.
                                </li>
                            </ul>
                        </li>
                        <li><span class="badge text-bg-warning">Todo</span> <strong>Data Access (APIM) [Multi-Cloud
                                Only]:</strong>
                            <ul>
                                <li><strong>Create:</strong> API Management (Consumption Tier).</li>
                                <li><strong>Action:</strong> Expose <code>Hot Reader</code> Function as an API.</li>
                                <li><strong>Purpose:</strong> Required only if L4/L5 are on a different cloud or using
                                    self-hosted tools that cannot access Cosmos DB natively.</li>
                            </ul>
                        </li>
                    </ul>

                    <!-- Layer 4 -->
                    <h3 class="mt-4 text-primary">Layer 4: Twin Management (ADT)</h3>
                    <ul>
                        <li><span class="badge text-bg-warning">Todo</span> <strong>Instance:</strong>
                            <ul>
                                <li><strong>Create:</strong> Azure Digital Twins instance.</li>
                            </ul>
                        </li>
                        <li><span class="badge text-bg-warning">Todo</span> <strong>Models & Graph:</strong>
                            <ul>
                                <li><strong>Action:</strong> Upload DTDL models and instantiate twin graph.</li>
                            </ul>
                        </li>
                    </ul>

                    <!-- Layer 5 -->
                    <h3 class="mt-4 text-primary">Layer 5: Visualization (Managed Grafana)</h3>
                    <ul>
                        <li><span class="badge text-bg-warning">Todo</span> <strong>Workspace:</strong>
                            <ul>
                                <li><strong>Create:</strong> Azure Managed Grafana workspace (Standard).</li>
                            </ul>
                        </li>
                        <li><span class="badge text-bg-warning">Todo</span> <strong>Data Sources:</strong>
                            <ul>
                                <li><strong>Single Cloud:</strong> Native plugins for Azure Monitor, Azure Digital
                                    Twins, and Cosmos DB.</li>
                                <li><strong>Multi Cloud:</strong> Generic JSON plugin to read from remote API Gateway
                                    (if L3 is remote and not Cosmos DB).</li>
                            </ul>
                        </li>
                    </ul>

                    <!-- Supporting -->
                    <h3 class="mt-4 text-primary">Supporting Services</h3>
                    <ul>
                        <li><span class="badge text-bg-warning">Todo</span> <strong>Logic Apps (Event
                                Workflow) [Optional]:</strong>
                            <ul>
                                <li><strong>Used in:</strong> Layer 2 (Triggered by Event Checker).</li>
                                <li><strong>Create:</strong> Logic App (Consumption).</li>
                            </ul>
                        </li>
                        <li><span class="badge text-bg-warning">Todo</span> <strong>Event Feedback Function
                                [Optional]:</strong>
                            <ul>
                                <li><strong>Used in:</strong> Layer 2 (Feedback Loop).</li>
                                <li><strong>Create:</strong> Function to send feedback commands to devices (via IoT
                                    Hub).</li>
                            </ul>
                        </li>
                        <li><span class="badge text-bg-warning">Todo</span> <strong>Hot Reader Function [Multi-Cloud
                                Only]:</strong>
                            <ul>
                                <li><strong>Used in:</strong> Layer 3 (Data Access).</li>
                                <li><strong>Create:</strong> Function to read data from Cosmos DB for APIM.</li>
                            </ul>
                        </li>
                        <li><span class="badge text-bg-secondary">Optional</span> <strong>Error Handling System
                                [Under Review]:</strong>
                            <ul>
                                <li><strong>Event Grid (System Topic):</strong>
                                    <ul>
                                        <li><strong>Topic:</strong> <code>{digital_twin_name}-errors</code>.</li>
                                        <li><strong>Purpose:</strong> Centralized error routing.</li>
                                    </ul>
                                </li>
                                <li><strong>Error Reporter Function:</strong>
                                    <ul>
                                        <li><strong>Trigger:</strong> Event Grid Trigger.</li>
                                        <li><strong>Logic:</strong> Formats error and writes to <strong>Cosmos DB Error
                                                Container</strong>.</li>
                                    </ul>
                                </li>
                                <li><strong>Error Container (Cosmos DB):</strong>
                                    <ul>
                                        <li><strong>Container:</strong> <code>SystemErrors</code>.</li>
                                        <li><strong>Purpose:</strong> Persistent storage for system errors (Cloud-Side
                                            Persistence).</li>
                                    </ul>
                                </li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </div>

            <div class="card mb-4" id="technical-specs">
                <h2 class="mb-3"><i class="fa-solid fa-cogs me-2"></i>Technical Specifications</h2>
                <div class="roadmap-content">
                    <h3 class="mt-4 text-primary">Cross-Cloud Implementation Details</h3>
                    <ul>
                        <li><strong>Configuration & Discovery:</strong>
                            <ul>
                                <li><strong>Mechanism:</strong> Application Settings (Environment Variables).</li>
                                <li><strong>Variables:</strong> <code>REMOTE_INGESTION_URL</code>,
                                    <code>REMOTE_WRITER_URL</code>, <code>REMOTE_READER_URL</code>.
                                </li>
                            </ul>
                        </li>
                        <li><strong>Authentication (Cross-Cloud Endpoints):</strong>
                            <ul>
                                <li><strong>Header:</strong> <code>X-Inter-Cloud-Token</code> for all cross-cloud HTTP
                                    calls.</li>
                                <li><strong>Environment Variable:</strong> Token stored as
                                    <code>INTER_CLOUD_TOKEN</code> in each Function App.
                                </li>
                                <li><strong>Generation:</strong> Secure random token generated during deployment,
                                    persisted to <code>inter_cloud_connections.json</code>.</li>
                                <li><strong>Validation:</strong> All L0 functions validate token before processing
                                    requests.</li>
                            </ul>
                        </li>
                        <li><strong>Error Handling Strategy: [Under review]</strong>
                            <ul>
                                <li><strong>Pipeline:</strong> Components publish to <strong>Event Grid</strong>.</li>
                                <li><strong>Persistence:</strong> Reporter writes to <strong>Cosmos DB</strong>
                                    (Cloud-First).</li>
                                <li><strong>Reliability:</strong> Connectors implement exponential backoff retries. Dead
                                    Letter Queues (DLQ) configured.</li>
                            </ul>
                        </li>
                        <li><strong>Data Contracts:</strong>
                            <ul>
                                <li><strong>Format:</strong> Standard JSON Envelope (built by
                                    <code>build_envelope()</code> in <code>_shared/inter_cloud.py</code>)
                                    <pre class="p-3 rounded"><code>{ 
    "source_cloud": "azure",
    "target_layer": "L2",
    "message_type": "telemetry",
    "timestamp": "2023-10-27T10:00:00Z",
    "payload": {...},
    "trace_id": "uuid-v4"
}</code></pre>
                                </li>
                                <li><strong>Fields:</strong>
                                    <ul>
                                        <li><code>source_cloud</code>: Originating cloud ("aws", "azure", "gcp")</li>
                                        <li><code>target_layer</code>: Destination layer ("L2", "L3", "L3_cold",
                                            "L3_archive")</li>
                                        <li><code>message_type</code>: Type of message ("telemetry", "chunk", etc.)</li>
                                        <li><code>trace_id</code>: UUID for distributed tracing</li>
                                    </ul>
                                </li>
                            </ul>
                        </li>
                    </ul>

                    <h3 class="mt-4 text-primary">Kudu ZIP Deployment</h3>
                    <p>Azure Functions are deployed using <strong>Kudu ZIP deployment</strong>, the standard
                        programmatic
                        approach for deploying code to Azure App Service and Azure Functions.</p>

                    <h4 class="mt-3">What is Kudu?</h4>
                    <ul>
                        <li><strong>Kudu</strong> is the deployment engine that powers Azure App Service and Azure
                            Functions.</li>
                        <li>It provides a REST API for deployments, file management, and diagnostics.</li>
                        <li>Every Function App has a <code>.scm.azurewebsites.net</code> subdomain for Kudu access.</li>
                    </ul>

                    <h4 class="mt-3">Why Kudu ZIP Deployment?</h4>
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Feature</th>
                                <th>Description</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Programmatic</strong></td>
                                <td>No CLI required - pure REST API via <code>requests.post()</code></td>
                            </tr>
                            <tr>
                                <td><strong>Atomic</strong></td>
                                <td>Entire deployment is atomic - no partial states</td>
                            </tr>
                            <tr>
                                <td><strong>Fast</strong></td>
                                <td>Direct upload without intermediary storage</td>
                            </tr>
                            <tr>
                                <td><strong>Language-agnostic</strong></td>
                                <td>Works from Python, Node.js, or any HTTP client</td>
                            </tr>
                        </tbody>
                    </table>

                    <h4 class="mt-3">Deployment Flow</h4>
                    <pre class="p-3 rounded"><code>1. Get Publish Credentials (Azure SDK)
   → WebSiteManagementClient.web_apps.list_publishing_credentials()

2. Compile Function Code (ZIP)
   → util.compile_azure_function(function_dir)

3. POST to Kudu Endpoint
   → https://{app-name}.scm.azurewebsites.net/api/zipdeploy
   → Headers: Content-Type: application/zip
   → Auth: Basic (publishing_user_name, publishing_password)

4. Kudu Extracts & Deploys
   → Function App automatically restarts with new code</code></pre>

                    <div class="callout info">
                        <strong><i class="fa-solid fa-info-circle me-2"></i>Note</strong>
                        <p class="mb-0">The Azure SDK does not directly support ZIP deployment.
                            We use the SDK to retrieve credentials, then the <code>requests</code> library
                            for the actual Kudu API call.</p>
                    </div>
                </div>
            </div>

            <div class="card mb-4" id="hierarchy-format">
                <h2 class="mb-3"><i class="fa-solid fa-sitemap me-2"></i>Azure Digital Twins Hierarchy Format</h2>
                <div class="roadmap-content">
                    <h3 class="mt-4 text-primary">JSON to NDJSON Conversion</h3>
                    <p>The <code>azure_hierarchy.json</code> file uses a human-readable JSON format for editing.
                        At deployment time (L4), it is converted to <strong>NDJSON</strong> (Newline Delimited JSON)
                        for the Azure Digital Twins Import Jobs API.</p>

                    <h4 class="mt-3">Why Two Formats?</h4>
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Format</th>
                                <th>Used For</th>
                                <th>Benefits</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>JSON</strong> (azure_hierarchy.json)</td>
                                <td>User editing, validation</td>
                                <td>Human-readable, easy to edit</td>
                            </tr>
                            <tr>
                                <td><strong>NDJSON</strong> (generated at deployment)</td>
                                <td>Import Jobs API upload</td>
                                <td>Streaming, handles large graphs</td>
                            </tr>
                        </tbody>
                    </table>

                    <h4 class="mt-3">Conversion Flow (Future - Import Jobs API)</h4>
                    <p class="text-muted"><em>Note: Current L4 uses Python SDK direct calls. This flow is for future
                            Import Jobs API optimization.</em></p>
                    <pre class="p-3 rounded"><code>azure_hierarchy.json (user edits)
        ↓
L4 Deployer: convert_to_ndjson()
        ↓
NDJSON file uploaded to Blob Storage
        ↓
Import Jobs API processes graph</code></pre>

                    <h4 class="mt-3">NDJSON Structure</h4>
                    <p>Each section marker is followed by individual objects, one per line:</p>
                    <pre class="p-3 rounded"><code>{"Section": "Header"}
{"fileVersion": "1.0.0", "author": "twin2clouds"}
{"Section": "Models"}
{"@id":"dtmi:...", "@type":"Interface", "@context":"dtmi:dtdl:context;3", ...}
{"Section": "Twins"}
{"$dtId":"room-1", "$metadata":{"$model":"dtmi:..."}}
{"Section": "Relationships"}
{"$dtId":"room-1", "$targetId":"machine-1", "$relationshipName":"contains"}</code></pre>

                    <div class="callout info">
                        <strong><i class="fa-solid fa-info-circle me-2"></i>Reference Files</strong>
                        <p class="mb-0">See
                            <code>upload/template/twin_hierarchy/azure_hierarchy_final.ndjson.example</code>
                            for a complete example of the NDJSON format.</p>
                    </div>
                </div>
            </div>

            <div class="card mb-4" id="future-work">
                <h2 class="mb-3"><i class="fa-solid fa-rocket me-2"></i>Future Work</h2>
                <div class="roadmap-content">
                    <h3 class="mt-4 text-primary">Azure AD Authentication for Function-to-Function Calls</h3>
                    <p>Currently, Azure-only function-to-function calls use <strong>Function Keys</strong> for
                        authentication.
                        A future enhancement could upgrade to <strong>Azure AD + Managed Identity</strong> for stronger
                        security.</p>

                    <h4 class="mt-3">Authentication Options Comparison</h4>
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Option</th>
                                <th>Security</th>
                                <th>Complexity</th>
                                <th>Use Case</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Custom Token (<code>X-Inter-Cloud-Token</code>)</td>
                                <td>⭐⭐ Basic</td>
                                <td>Simple</td>
                                <td>Cross-cloud calls (required)</td>
                            </tr>
                            <tr class="table-info">
                                <td><strong>Function Keys</strong> (<code>x-functions-key</code>)</td>
                                <td>⭐⭐⭐ Basic+</td>
                                <td>Simpler</td>
                                <td><strong>Azure-only calls (current)</strong></td>
                            </tr>
                            <tr>
                                <td>Azure AD + Managed Identity</td>
                                <td>⭐⭐⭐⭐⭐ Enterprise</td>
                                <td>More complex</td>
                                <td>Azure-only calls (future)</td>
                            </tr>
                        </tbody>
                    </table>

                    <h4 class="mt-3">Why Upgrade to Azure AD?</h4>
                    <ul>
                        <li><strong>Auto-rotating tokens:</strong> OAuth tokens managed by Azure AD, no manual rotation
                        </li>
                        <li><strong>Full audit trail:</strong> Azure AD logs show who called what, when</li>
                        <li><strong>Granular access control:</strong> Can enforce MFA, conditional access policies</li>
                        <li><strong>No additional cost:</strong> Azure AD auth is included in Azure Functions pricing
                        </li>
                    </ul>

                    <h4 class="mt-3">Implementation Notes</h4>
                    <ul>
                        <li>Target Function Apps would need Azure AD authentication configured (Easy Auth)</li>
                        <li>Calling functions would acquire tokens via Managed Identity</li>
                        <li>Minimal latency overhead for token acquisition</li>
                        <li>Would require code changes in <code>_shared/inter_cloud.py</code></li>
                    </ul>

                    <div class="callout info">
                        <strong><i class="fa-solid fa-info-circle me-2"></i>Current Implementation</strong>
                        <p class="mb-0">Azure-only calls use Function Keys. Cross-cloud calls use custom tokens.
                            Azure AD enhancement can be added when enterprise-grade security is required.</p>
                    </div>

                    <h3 class="mt-4 text-primary">Import Jobs API for Bulk Twin Imports</h3>
                    <p>The current L4 implementation uses the <strong>Python SDK direct calls</strong> to create DTDL
                        models,
                        twins, and relationships one-by-one. This matches the AWS TwinMaker pattern and provides
                        explicit control over each operation.</p>

                    <h4 class="mt-3">Why Python SDK Direct Calls (Current)?</h4>
                    <ul>
                        <li><strong>Explicit control:</strong> Each model/twin/relationship is created individually with
                            full error handling</li>
                        <li><strong>Simpler debugging:</strong> Failures are immediately visible at the specific
                            operation</li>
                        <li><strong>Pattern consistency:</strong> Matches the AWS TwinMaker L4 implementation pattern
                        </li>
                        <li><strong>Sufficient for typical hierarchies:</strong> Most Digital Twin deployments have
                            tens to hundreds of twins, not millions</li>
                    </ul>

                    <h4 class="mt-3">When to Consider Import Jobs API</h4>
                    <p>Azure Digital Twins provides a <strong>bulk Import Jobs API</strong> that processes NDJSON files
                        from Blob Storage. This should be considered when:</p>
                    <ul>
                        <li><strong>Large hierarchies:</strong> Thousands of twins with complex relationships</li>
                        <li><strong>Performance critical:</strong> Deployment time is a key constraint</li>
                        <li><strong>Batch updates:</strong> Need to update many twins atomically</li>
                    </ul>

                    <h4 class="mt-3">Import Jobs API Flow (Future)</h4>
                    <pre class="p-3 rounded"><code>1. Convert azure_hierarchy.json to NDJSON
2. Upload NDJSON to Blob Storage container
3. Call ADT Import Jobs API with blob URL
4. Poll for job completion
5. Handle partial failures via job status</code></pre>

                    <div class="callout info">
                        <strong><i class="fa-solid fa-info-circle me-2"></i>Current Implementation</strong>
                        <p class="mb-0">L4 uses Python SDK direct calls for model/twin/relationship creation.
                            The NDJSON conversion utility exists for future Import Jobs API integration.
                            See <code>upload/template/twin_hierarchy/azure_hierarchy_final.ndjson.example</code>.</p>
                    </div>
                </div>
            </div>

        </main>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <button id="backToTop" class="btn btn-primary rounded-circle position-fixed bottom-0 end-0 m-4 shadow fade p-3"
        style="display:none;">
        <i class="fa-solid fa-arrow-up"></i>
    </button>
    <script src="js/docs-nav.js" defer></script>
</body>

</html>