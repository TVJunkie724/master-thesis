<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <title>IoT & Hierarchy Configuration â€” Deployer Documentation</title>
    <link rel="icon" type="image/x-icon" href="references/favicon.ico">
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link rel="stylesheet" href="css/docs_styles.css" />
</head>

<body>
    <div class="layout">
        <aside id="nav-placeholder"></aside>
        <main class="p-4">
            <h1 class="mb-3"><i class="fa-solid fa-sitemap me-2"></i>IoT & Hierarchy Configuration</h1>
            <p class="text-muted mb-4">Device definitions, entity structure, and event triggers.</p>

            <nav aria-label="breadcrumb" class="mb-4">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="docs-configuration.html">Configuration</a></li>
                    <li class="breadcrumb-item active">IoT & Hierarchy</li>
                </ol>
            </nav>

            <!-- config_iot_devices.json -->
            <div class="card mb-4" id="config-iot-devices">
                <h2 class="mb-3"><i class="fa-solid fa-microchip me-2"></i>config_iot_devices.json</h2>
                <p><strong>Purpose:</strong> Define IoT devices and their properties.</p>
                <p><strong>Location:</strong> <code>./config_iot_devices.json</code></p>

                <h4 class="mt-3">Schema</h4>
                <pre class="p-3 rounded"><code>[
  {
    "id": "string",
    "properties": [
      {
        "name": "string",
        "dataType": "STRING | DOUBLE | INTEGER | BOOLEAN",
        "initValue": any  // optional
      }
    ]
  }
]</code></pre>

                <h4 class="mt-3">Example</h4>
                <pre class="p-3 rounded"><code>[
  {
    "id": "temperature-sensor-1",
    "properties": [
      { "name": "temperature", "dataType": "DOUBLE" }
    ]
  },
  {
    "id": "temperature-sensor-1-const",
    "properties": [
      { "name": "serial-number", "dataType": "STRING", "initValue": "temp-sens-143323" },
      { "name": "maxTemperature", "dataType": "DOUBLE", "initValue": 60.0 }
    ]
  }
]</code></pre>

                <p class="mt-2"><strong>Notes:</strong></p>
                <ul>
                    <li>Each device gets its own processor Lambda function deployed</li>
                    <li>Devices with <code>initValue</code> properties are treated as constant/static properties</li>
                    <li>Device IDs must be unique within the digital twin</li>
                </ul>
            </div>

            <!-- config_hierarchy.json -->
            <div class="card mb-4" id="config-hierarchy">
                <h2 class="mb-3"><i class="fa-solid fa-sitemap me-2"></i>config_hierarchy.json</h2>
                <p><strong>Purpose:</strong> Define the TwinMaker entity hierarchy (rooms, machines, components).</p>
                <p><strong>Location:</strong> <code>./config_hierarchy.json</code></p>

                <h4 class="mt-3">Schema</h4>
                <pre class="p-3 rounded"><code>[
  {
    "type": "entity" | "component",
    "id": "string",           // for entities
    "name": "string",         // for components
    "componentTypeId": "string",  // optional
    "iotDeviceId": "string",      // optional
    "children": [ ... ]       // nested entities/components
  }
]</code></pre>

                <h4 class="mt-3">Example</h4>
                <pre class="p-3 rounded"><code>[
  {
    "type": "entity",
    "id": "room-1",
    "children": [
      {
        "type": "entity",
        "id": "machine-1",
        "children": [
          {
            "type": "component",
            "name": "temperature-sensor-1",
            "componentTypeId": "dt-temperature-sensor-1"
          }
        ]
      },
      {
        "type": "component",
        "name": "temperature-sensor-2",
        "iotDeviceId": "temperature-sensor-2"
      }
    ]
  }
]</code></pre>

                <p class="mt-2"><strong>Notes:</strong></p>
                <ul>
                    <li>Hierarchy is deployed to AWS IoT TwinMaker or Azure Digital Twins</li>
                    <li>Components reference IoT devices defined in <code>config_iot_devices.json</code></li>
                    <li>Supports arbitrary nesting depth</li>
                </ul>
            </div>

            <!-- config_events.json -->
            <div class="card mb-4" id="config-events">
                <h2 class="mb-3"><i class="fa-solid fa-bolt me-2"></i>config_events.json</h2>
                <p><strong>Purpose:</strong> Define event conditions and automated actions.</p>
                <p><strong>Location:</strong> <code>./config_events.json</code></p>

                <h4 class="mt-3">Schema</h4>
                <pre class="p-3 rounded"><code>[
  {
    "condition": "string",  // TwinMaker query expression
    "action": {
      "type": "lambda",
      "functionName": "string",
      "pathToCode": "string",  // optional
      "autoDeploy": boolean,
      "feedback": {
        "type": "mqtt",
        "topic": "string",        // or
        "iotDeviceId": "string",  // alternative
        "payload": object | "action-result"
      }
    }
  }
]</code></pre>

                <h4 class="mt-3">Example</h4>
                <pre class="p-3 rounded"><code>[
  {
    "condition": "room-1.temperature-sensor-2.temperature == DOUBLE(40)",
    "action": {
      "type": "lambda",
      "functionName": "high-temperature-callback",
      "autoDeploy": true,
      "feedback": {
        "type": "mqtt",
        "topic": "dt-temperature-sensor-2",
        "payload": {
          "message": "Temperature too high!"
        }
      }
    }
  }
]</code></pre>

                <p class="mt-2"><strong>Notes:</strong></p>
                <ul>
                    <li>Conditions use TwinMaker query syntax</li>
                    <li>If <code>autoDeploy</code> is true, the Lambda function is automatically deployed</li>
                    <li>Feedback can be sent via MQTT to IoT devices</li>
                </ul>
            </div>

        </main>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <button id="backToTop" class="btn btn-primary rounded-circle position-fixed bottom-0 end-0 m-4 shadow fade p-3"
        style="display:none;"><i class="fa-solid fa-arrow-up"></i></button>
    <script src="js/docs-nav.js" defer></script>
</body>

</html>