<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <title>IoT Device Simulator — Deployer Documentation</title>
    <link rel="icon" type="image/x-icon" href="references/favicon.ico">
    <meta name="viewport" content="width=device-width,initial-scale=1" />

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link rel="stylesheet" href="css/docs_styles.css" />
</head>

<body>

    <div class="layout">
        <aside id="nav-placeholder"></aside>

        <main class="p-4">
            <h1 class="mb-3">
                <i class="fa-solid fa-microchip me-2"></i> IoT Device Simulator
            </h1>

            <p class="text-muted mb-4">
                Simulate IoT device telemetry for testing and development without physical hardware.
            </p>

            <div class="callout info mb-4">
                <strong><i class="fa-solid fa-check-circle me-2"></i>Status: AWS Implementation Complete</strong>
                The IoT Device Simulator is fully integrated for AWS. Azure and GCP implementations will follow when
                their respective deployers are completed.
            </div>

            <div class="card mb-4">
                <h2 class="mb-3"><i class="fa-solid fa-lightbulb me-2"></i>Overview</h2>
                <p>The IoT Device Simulator allows you to:</p>
                <ul>
                    <li><strong>Test deployments</strong> without physical IoT devices</li>
                    <li><strong>Send custom payloads</strong> to verify data processing pipelines</li>
                    <li><strong>Debug issues</strong> by inspecting the data flow from L1 to L3</li>
                    <li><strong>Export standalone packages</strong> for external testing or real device provisioning
                    </li>
                </ul>
            </div>

            <div class="card mb-4">
                <h2 class="mb-3"><i class="fa-solid fa-folder-tree me-2"></i>Architecture</h2>

                <h3 class="mt-4 text-primary">File Structure</h3>
                <p>The simulator uses a split architecture:</p>

                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Location</th>
                                <th>Purpose</th>
                                <th>User Editable?</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><code>src/iot_device_simulator/{provider}/</code></td>
                                <td>Core simulator logic (main.py, transmission.py, globals.py)</td>
                                <td>No (System Code)</td>
                            </tr>
                            <tr>
                                <td><code>upload/{project}/iot_device_simulator/{provider}/payloads.json</code></td>
                                <td>User-defined payload data to send</td>
                                <td><strong>Yes</strong></td>
                            </tr>
                            <tr>
                                <td><code>upload/{project}/iot_device_simulator/{provider}/config_generated.json</code>
                                </td>
                                <td>Auto-generated configuration (endpoint, topic, cert paths)</td>
                                <td>No (Generated at L1 deploy)</td>
                            </tr>
                            <tr>
                                <td><code>upload/{project}/iot_devices_auth/{device_id}/</code></td>
                                <td>Device certificates (generated during L1 deployment)</td>
                                <td>No (Generated at L1 deploy)</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <h3 class="mt-4 text-primary">Data Flow</h3>
                <pre
                    class="p-3 rounded"><code>payloads.json → Simulator → MQTT/Pub/Sub → L1 Dispatcher → L2 Persister → L3 DynamoDB/Cosmos/Firestore</code></pre>
            </div>

            <div class="card mb-4">
                <h2 class="mb-3"><i class="fa-solid fa-file-code me-2"></i>Payloads File</h2>
                <p>The <code>payloads.json</code> file is the <strong>only user-editable file</strong> for the
                    simulator. It defines what data the simulated device will send.</p>

                <h3 class="mt-4 text-primary">Required Structure</h3>
                <pre class="p-3 rounded"><code>[
  {
    "iotDeviceId": "temperature-sensor-1",
    "temperature": 25.5,
    "humidity": 60,
    "time": ""
  },
  {
    "iotDeviceId": "temperature-sensor-1",
    "temperature": 26.1,
    "humidity": 58,
    "time": ""
  }
]</code></pre>

                <h3 class="mt-4 text-primary">Validation Rules</h3>
                <ul>
                    <li>Must be a valid JSON <strong>array</strong></li>
                    <li>Each object <strong>must</strong> have an <code>iotDeviceId</code> field</li>
                    <li>The <code>iotDeviceId</code> should match a device defined in
                        <code>config_iot_devices.json</code>
                    </li>
                    <li>The <code>time</code> field is optional (auto-filled with current timestamp if empty)</li>
                    <li>Additional properties are user-defined (should match device properties)</li>
                </ul>
            </div>

            <div class="card mb-4">
                <h2 class="mb-3"><i class="fa-solid fa-code me-2"></i>API Endpoints</h2>

                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Method</th>
                                <th>Endpoint</th>
                                <th>Description</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><span class="badge bg-success">PUT</span></td>
                                <td><code>/projects/{project}/simulator/{provider}/payloads</code></td>
                                <td>Upload/update payloads.json</td>
                            </tr>
                            <tr>
                                <td><span class="badge bg-primary">GET</span></td>
                                <td><code>/projects/{project}/simulator/{provider}/payloads/validate</code></td>
                                <td>Validate existing payloads.json</td>
                            </tr>
                            <tr>
                                <td><span class="badge bg-primary">GET</span></td>
                                <td><code>/projects/{project}/simulator/{provider}/download</code></td>
                                <td>Download standalone simulator package</td>
                            </tr>
                            <tr>
                                <td><span class="badge bg-info">WebSocket</span></td>
                                <td><code>/projects/{project}/simulator/{provider}/stream</code></td>
                                <td>Real-time control and log streaming</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="card mb-4">
                <h2 class="mb-3"><i class="fa-solid fa-terminal me-2"></i>CLI Usage</h2>
                <p>Run the simulator interactively from the CLI:</p>
                <pre class="p-3 rounded"><code># Start the CLI
docker exec -it -e PYTHONPATH=/app master-thesis-3cloud-deployer-1 python src/main.py

# In the CLI, run the simulator
> simulate aws

# Available commands in the simulator:
> send     # Send the next payload
> help     # Show available commands
> exit     # Return to main CLI</code></pre>
            </div>

            <div class="card mb-4">
                <h2 class="mb-3"><i class="fa-solid fa-download me-2"></i>Standalone Package</h2>
                <p>Download a complete, self-contained simulator package for external use:</p>

                <pre class="p-3 rounded"><code>GET /projects/{project}/simulator/{provider}/download</code></pre>

                <h3 class="mt-4 text-primary">Package Contents</h3>
                <pre class="p-3 rounded"><code>simulator_package_{project}_{provider}.zip
├── README.md                 # Setup and usage guide
├── requirements.txt          # Python dependencies
├── Dockerfile                # Docker setup
├── docker-compose.yml        # Easy startup
├── config.json               # Runtime configuration
├── payloads.json             # Payload definitions
├── AmazonRootCA1.pem         # Root CA certificate (AWS)
├── certificates/             # Device certificates
│   └── {device_id}/
│       ├── certificate.pem.crt
│       └── private.pem.key
└── src/                      # Simulator code
    ├── main.py
    ├── transmission.py
    └── globals.py</code></pre>

                <h3 class="mt-4 text-primary">Running the Package</h3>
                <pre class="p-3 rounded"><code># Option 1: Python directly
pip install -r requirements.txt
python src/main.py

# Option 2: Docker
docker-compose up --build</code></pre>
            </div>

            <div class="card mb-4">
                <h2 class="mb-3"><i class="fa-solid fa-cloud me-2"></i>Provider-Specific Notes</h2>

                <h3 class="mt-4 text-primary"><i class="fa-brands fa-aws me-2"></i>AWS</h3>
                <ul>
                    <li>Uses MQTT over TLS to AWS IoT Core</li>
                    <li>Root CA: <code>AmazonRootCA1.pem</code> (bundled in src/)</li>
                    <li>Device certificates generated via <code>create_keys_and_certificate</code></li>
                    <li>Topic: <code>{digital_twin_name}/iot-data</code></li>
                </ul>

                <h3 class="mt-4 text-primary"><i class="fa-brands fa-microsoft me-2"></i>Azure <span
                        class="chip warn">Future</span></h3>
                <ul>
                    <li>Will use MQTT to Azure IoT Hub</li>
                    <li>Auth: SAS tokens or Device Certificates</li>
                    <li>Root CA: DigiCert Baltimore Root</li>
                </ul>

                <h3 class="mt-4 text-primary"><i class="fa-brands fa-google me-2"></i>GCP <span
                        class="chip warn">Future</span></h3>
                <ul>
                    <li>Will use Pub/Sub directly (Cloud IoT Core deprecated)</li>
                    <li>Auth: JWT tokens with Service Account</li>
                </ul>
            </div>

            <div class="card mb-4">
                <h2 class="mb-3"><i class="fa-solid fa-shield-halved me-2"></i>Security Considerations</h2>
                <div class="callout warn">
                    <strong><i class="fa-solid fa-exclamation-triangle me-2"></i>Important</strong>
                    <p class="mb-0">
                        The download endpoint exposes device private keys. In production environments,
                        protect this endpoint with authentication or restrict access. The standalone
                        package should be treated as sensitive and stored securely.
                    </p>
                </div>
            </div>

        </main>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <button id="backToTop" class="btn btn-primary rounded-circle position-fixed bottom-0 end-0 m-4 shadow fade p-3"
        style="display:none;">
        <i class="fa-solid fa-arrow-up"></i>
    </button>
    <script src="js/docs-nav.js" defer></script>
</body>

</html>