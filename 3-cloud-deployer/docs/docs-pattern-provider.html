<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <title>Provider Pattern — Deployer Documentation</title>
    <link rel="icon" type="image/x-icon" href="references/favicon.ico">
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link rel="stylesheet" href="css/docs_styles.css" />
</head>

<body>
    <div class="layout">
        <aside id="nav-placeholder"></aside>
        <main class="p-4">
            <h1 class="mb-3"><i class="fa-solid fa-industry me-2"></i>Provider Pattern (Abstract Factory)</h1>
            <p class="text-muted mb-4">Factory that groups SDK clients, resource names, and strategies.</p>

            <nav aria-label="breadcrumb" class="mb-4">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="docs-design-patterns.html">Design Patterns</a></li>
                    <li class="breadcrumb-item active">Provider</li>
                </ol>
            </nav>

            <div class="card mb-4">
                <h2 class="mb-3">Definition</h2>
                <p>The Abstract Factory Pattern provides an interface for creating families of related objects
                    without specifying their concrete classes.</p>

                <h4 class="mt-4">Why We Use It</h4>
                <p>Each cloud provider needs multiple related objects: SDK clients, resource name generators,
                    and deployer strategies. The Provider pattern groups these together.</p>
            </div>

            <div class="card mb-4">
                <h2 class="mb-3">Pattern Diagram</h2>
                <pre class="p-3 rounded bg-dark text-light"><code>┌─────────────────────────────────────────────────────────────────────────────┐
│                           CloudProvider (Protocol)                          │
├─────────────────────────────────────────────────────────────────────────────┤
│  Properties:                                                                │
│   - name: str                       ← "aws", "azure", or "gcp"              │
│   - clients: Dict[str, Any]         ← Initialized SDK clients               │
│                                                                             │
│  Methods:                                                                   │
│   - initialize_clients(credentials) ← Create SDK clients (boto3, etc.)      │
│   - get_resource_name(type, suffix) ← Generate "{twin}-{type}-{suffix}"     │
│   - get_deployer_strategy()         ← Return the Strategy for this provider │
└─────────────────────────────────────────────────────────────────────────────┘
                                      │
                                      │ implements
        ┌─────────────────────────────┼─────────────────────────────┐
        │                             │                             │
        ▼                             ▼                             ▼
┌───────────────────┐       ┌───────────────────┐       ┌───────────────────┐
│   AWSProvider     │       │   AzureProvider   │       │   GCPProvider     │
├───────────────────┤       ├───────────────────┤       ├───────────────────┤
│ - name = "aws"    │       │ - name = "azure"  │       │ - name = "gcp"    │
│ - clients: {      │       │ - clients: {      │       │ - clients: {      │
│     iam, lambda,  │       │     mgmt, funcs,  │       │     pubsub, funcs │
│     dynamodb, ... │       │     cosmosdb, ... │       │     firestore,... │
│   }               │       │   }               │       │   }               │
└───────────────────┘       └───────────────────┘       └───────────────────┘</code></pre>
            </div>

            <div class="card mb-4">
                <h2 class="mb-3">Implementation</h2>
                <h5>Protocol Definition</h5>
                <pre class="p-3 rounded"><code># File: src/core/protocols.py

@runtime_checkable
class CloudProvider(Protocol):
    """Factory interface for cloud providers."""
    
    @property
    def name(self) -> str:
        """Return provider ID: 'aws', 'azure', or 'gcp'."""
        ...
    
    @property
    def clients(self) -> Dict[str, Any]:
        """Return initialized SDK clients."""
        ...
    
    def initialize_clients(self, credentials: dict, twin_name: str) -> None:
        """Initialize SDK clients with credentials."""
        ...
    
    def get_resource_name(self, resource_type: str, suffix: str = "") -> str:
        """Generate namespaced resource name."""
        ...
    
    def get_deployer_strategy(self) -> DeployerStrategy:
        """Return the deployment strategy for this provider."""
        ...</code></pre>

                <h5 class="mt-4">Concrete Implementation</h5>
                <pre class="p-3 rounded"><code># File: src/providers/aws/provider.py

class AWSProvider:
    """AWS implementation of CloudProvider."""
    
    name = "aws"
    
    def initialize_clients(self, credentials: dict, twin_name: str) -> None:
        import boto3
        self._twin_name = twin_name
        self._clients = {
            "iam": boto3.client("iam", **credentials),
            "lambda": boto3.client("lambda", **credentials),
            "dynamodb": boto3.client("dynamodb", **credentials),
            # ... more clients
        }
    
    @property
    def clients(self) -> dict:
        return self._clients
    
    def get_resource_name(self, resource_type: str, suffix: str = "") -> str:
        if suffix:
            return f"{self._twin_name}-{resource_type}-{suffix}"
        return f"{self._twin_name}-{resource_type}"
    
    def get_deployer_strategy(self) -> AWSDeployerStrategy:
        return AWSDeployerStrategy(self)</code></pre>
            </div>
        </main>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <button id="backToTop" class="btn btn-primary rounded-circle position-fixed bottom-0 end-0 m-4 shadow fade p-3"
        style="display:none;"><i class="fa-solid fa-arrow-up"></i></button>
    <script src="js/docs-nav.js" defer></script>
</body>

</html>