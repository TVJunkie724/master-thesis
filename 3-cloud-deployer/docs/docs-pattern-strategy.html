<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <title>Strategy Pattern — Deployer Documentation</title>
    <link rel="icon" type="image/x-icon" href="references/favicon.ico">
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link rel="stylesheet" href="css/docs_styles.css" />
</head>

<body>
    <div class="layout">
        <aside id="nav-placeholder"></aside>
        <main class="p-4">
            <h1 class="mb-3"><i class="fa-solid fa-shuffle me-2"></i>Strategy Pattern</h1>
            <p class="text-muted mb-4">Interchangeable deployment algorithms for each cloud provider.</p>

            <nav aria-label="breadcrumb" class="mb-4">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="docs-design-patterns.html">Design Patterns</a></li>
                    <li class="breadcrumb-item active">Strategy</li>
                </ol>
            </nav>

            <div class="card mb-4">
                <h2 class="mb-3">Definition</h2>
                <p>The Strategy Pattern defines a family of algorithms, encapsulates each one, and makes them
                    interchangeable. It lets the algorithm vary independently from clients that use it.</p>

                <h4 class="mt-4">Why We Use It</h4>
                <p>Each cloud provider (AWS, Azure, GCP) has different ways to deploy the same logical layer.
                    The Strategy pattern allows us to swap implementations without changing the code that uses them.</p>
            </div>

            <div class="card mb-4">
                <h2 class="mb-3">Pattern Diagram</h2>
                <pre class="p-3 rounded bg-dark text-light"><code>                          ┌─────────────────────────┐
                          │   DeployerStrategy      │  ← Interface/Protocol
                          │   (Abstract)            │
                          ├─────────────────────────┤
                          │ + deploy_l1(context)    │
                          │ + destroy_l1(context)   │
                          │ + deploy_l2(context)    │
                          │ + ...                   │
                          └───────────┬─────────────┘
                                      │
              ┌───────────────────────┼───────────────────────┐
              │ implements            │ implements            │ implements
              ▼                       ▼                       ▼
    ┌─────────────────────┐ ┌─────────────────────┐ ┌─────────────────────┐
    │ AWSDeployerStrategy │ │AzureDeployerStrategy│ │ GCPDeployerStrategy │
    ├─────────────────────┤ ├─────────────────────┤ ├─────────────────────┤
    │ Uses boto3, Lambda, │ │ Uses azure-sdk,     │ │ Uses google-cloud,  │
    │ DynamoDB, TwinMaker │ │ Functions, CosmosDB │ │ Pub/Sub, Firestore  │
    └─────────────────────┘ └─────────────────────┘ └─────────────────────┘</code></pre>
            </div>

            <div class="card mb-4">
                <h2 class="mb-3">Implementation</h2>
                <h5>Interface Definition</h5>
                <pre class="p-3 rounded"><code># File: src/core/protocols.py

@runtime_checkable
class DeployerStrategy(Protocol):
    """Strategy interface for deployment operations."""
    
    def deploy_l1(self, context: DeploymentContext) -> None: ...
    def destroy_l1(self, context: DeploymentContext) -> None: ...
    def deploy_l2(self, context: DeploymentContext) -> None: ...
    # ... more layer methods</code></pre>

                <h5 class="mt-4">Concrete Implementations</h5>
                <pre class="p-3 rounded"><code># File: src/providers/aws/deployer_strategy.py

class AWSDeployerStrategy:
    """AWS implementation of DeployerStrategy."""
    
    def __init__(self, provider: AWSProvider):
        self._provider = provider
    
    def deploy_l1(self, context: DeploymentContext) -> None:
        """Deploy L1 using AWS IoT Core and Lambda."""
        # Create IAM role
        # Create Lambda function  
        # Create IoT rule
        ...

# File: src/providers/azure/deployer_strategy.py

class AzureDeployerStrategy:
    """Azure implementation of DeployerStrategy."""
    
    def deploy_l1(self, context: DeploymentContext) -> None:
        """Deploy L1 using Azure IoT Hub and Functions."""
        # Create IoT Hub
        # Create Azure Function
        # Configure message routing
        ...</code></pre>
            </div>

            <div class="card mb-4">
                <h2 class="mb-3">Usage</h2>
                <pre class="p-3 rounded"><code># The core deployer doesn't know which cloud is being used
def deploy_l1(context: DeploymentContext) -> None:
    provider = context.get_provider_for_layer(1)
    strategy = provider.get_deployer_strategy()
    strategy.deploy_l1(context)  # Calls AWS, Azure, or GCP automatically</code></pre>
            </div>
        </main>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <button id="backToTop" class="btn btn-primary rounded-circle position-fixed bottom-0 end-0 m-4 shadow fade p-3"
        style="display:none;"><i class="fa-solid fa-arrow-up"></i></button>
    <script src="js/docs-nav.js" defer></script>
</body>

</html>